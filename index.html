<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V 1.1 BETA</title>
    <style>
        :root { --blue: #003366; --red: #e30613; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; }
        
        /* LOGIN PAGE */
        #page_login { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: var(--blue); display: flex; align-items: center; justify-content: center; z-index: 10000;
        }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .btn-confirm { background: var(--red); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* DASHBOARD */
        .header { text-align: center; padding: 20px; background: var(--white); border-bottom: 5px solid var(--red); }
        .logo-consorzio { height: 100px; margin-bottom: 10px; }
        .logo-securitas { height: 40px; }
        .version-label { color: var(--blue); font-weight: bold; margin-top: 5px; }

        .dashboard-main { display: flex; flex-direction: column; align-items: center; padding: 40px; background: white; margin: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .clock-big { font-size: 4rem; font-weight: bold; color: var(--blue); margin: 10px 0; }
        .world-clocks { display: flex; gap: 30px; margin-top: 20px; color: #666; }
        
        /* SECTIONS */
        .container { display: none; padding: 20px; max-width: 1200px; margin: auto; }
        .active-page { display: block; }
        .nav-menu { display: flex; justify-content: center; gap: 10px; padding: 20px; background: #eee; }
        .nav-btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: var(--blue); color: white; font-weight: bold; }
        
        /* CHECKLIST */
        .fase-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--red); }
        .check-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .time-stamp { margin-left: auto; color: var(--red); font-weight: bold; font-family: monospace; }
        .count-badge { background: var(--blue); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="page_login">
        <div class="login-card">
            <img src="https://via.placeholder.com/150x50?text=SECURITAS" style="margin-bottom:20px;">
            <h3>GESTIONALE NSIF</h3>
            <input type="text" id="user_field" placeholder="User / E-mail" onkeypress="handleEnter(event, 'pass_field')">
            <input type="password" id="pass_field" placeholder="Password" onkeypress="handleEnter(event, 'login_submit')">
            <button id="login_submit" class="btn-confirm" onclick="checkLogin()">CONFERMA</button>
            <p><a href="#" style="font-size: 0.8rem; color: #666;">Password dimenticata</a></p>
        </div>
    </div>

    <div id="main_ui" style="display:none;">
        <div class="header">
            <img src="logo_consorzio_grande.png" class="logo-consorzio" alt="LOGO CONSORZIO" onerror="this.src='https://via.placeholder.com/300x100?text=LOGO+CONSORZIO'">
            <br>
            <img src="logo_securitas.png" class="logo-securitas" alt="SECURITAS" onerror="this.src='https://via.placeholder.com/150x40?text=SECURITAS'">
            <div class="version-label">NSFI CASTIONE – GESTIONALE V 1.1 BETA</div>
        </div>

        <nav class="nav-menu">
            <button class="nav-btn" onclick="showPage('page_home')">HOME</button>
            <button class="nav-btn" onclick="showPage('page_checklist')">CHECKLIST TURNI</button>
            <button class="nav-btn" onclick="showPage('page_links')">LINK ESTERNI</button>
            <button id="btn_admin" class="nav-btn" style="background:#333; display:none;" onclick="showPage('page_admin')">AMMINISTRATORE</button>
            <button class="nav-btn" style="background:#666;" onclick="logout()">LOGOUT</button>
        </nav>

        <div id="page_home" class="container active-page">
            <div class="dashboard-main">
                <div id="current_date" style="font-size: 1.5rem; color: #333;">Lunedì, 16 Febbraio 2026</div>
                <div id="main_clock" class="clock-big">00:00:00</div>
                <div class="world-clocks">
                    <div>Zurigo: <span id="clock_zur">00:00</span></div>
                    <div>Londra: <span id="clock_lon">00:00</span></div>
                    <div>New York: <span id="clock_ny">00:00</span></div>
                </div>
                <div style="margin-top:30px; padding:15px; background:#e0f7fa; border-radius:10px; width:100%; text-align:center;">
                    <strong>METEO CASTIONE:</strong> ☀️ Sereno, 8°C | Vento: 5 km/h Nord
                </div>
            </div>
            
            <div id="external_buttons_home" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; justify-content: center;">
                </div>
        </div>

        <div id="page_checklist" class="container">
            <h2>Checklist Operativa</h2>
            <div style="margin-bottom:20px;">
                <button class="nav-btn" onclick="loadChecklist('T1')">TURNO T1</button>
                <button class="nav-btn" onclick="loadChecklist('T2')">TURNO T2</button>
                <button class="nav-btn" onclick="loadChecklist('T3')">TURNO T3</button>
            </div>
            <div id="checklist_content"></div>
        </div>

        <div id="page_admin" class="container">
            <h2>Pannello Amministratore</h2>
            <div class="fase-box">
                <h3>Gestione Account</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:10px; margin-bottom:20px;">
                    <input type="text" id="new_user" placeholder="Email">
                    <input type="password" id="new_pass" placeholder="Password">
                    <select id="new_lvl">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="superuser">Superuser</option>
                        <option value="guest">Guest</option>
                    </select>
                    <button class="btn-confirm" onclick="addUser()">AGGIUNGI</button>
                </div>
                <table width="100%" border="1" cellpadding="10" style="border-collapse:collapse;">
                    <thead><tr><th>User</th><th>Livello</th><th>Stato</th><th>Azioni</th></tr></thead>
                    <tbody id="user_list_body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // DATI INIZIALI E IMPORT DAI DOCUMENTI
        const adminUser = "marco.lamorgia@securitas.ch";
        const adminPass = "1234";
        
        let users = [
            {email: adminUser, pass: adminPass, lvl: 'admin', status: 'ATTIVO', expiry: 999}
        ];

        const turniData = {
            T1: {
                inizio: [
                    {t: "Aprire cancello Campo Base Nord", c: "6988", n: ""},
                    {t: "Aprire ufficio Campo Base Nord", c: "1907", n: ""},
                    {t: "Accendere telefono servizio", c: "PIN 6681 / Sblocco 1907", n: "Tenerlo fino arrivo T3"},
                    {t: "Apertura CAST07", c: "1907", n: ""},
                    {t: "Verifica VTI External", c: "", n: "Sharing documenti"}
                ],
                durante: [{t: "Verifica tornelli e luci", c: "", n: ""}],
                fine: [{t: "Passaggio di consegna CAST09", c: "", n: ""}]
            },
            T2: {
                inizio: [
                    {t: "Aprire cancello entrata/uscita CAST09", c: "6988", n: ""},
                    {t: "Aprire ufficio CAST09", c: "1907", n: ""},
                    {t: "Gestione rubinetti Campo Base Sud", c: "", n: "Chiave in Keybox CAST09"}
                ],
                durante: [{t: "Presidio barriera invernale", c: "", n: "Pulizia fotocellule"}],
                fine: [{t: "Pulizia postazione", c: "", n: ""}]
            },
            T3: {
                inizio: [
                    {t: "Ritiro telefono servizio CAST07", c: "", n: ""},
                    {t: "Giro cantiere con monopattino", c: "", n: "Prendere monopattino al CAST09"}
                ],
                durante: [{t: "Controllo CAST08", c: "", n: "Verifica presidio e varchi"}],
                fine: [{t: "Chiusura perimetro", c: "", n: ""}]
            }
        };

        // INIZIALIZZAZIONE
        window.onload = () => {
            const lastUser = localStorage.getItem('last_user');
            if(lastUser) document.getElementById('user_field').value = lastUser;
            updateClock();
            setInterval(updateClock, 1000);
        };

        function handleEnter(e, nextId) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const nextElem = document.getElementById(nextId);
                if(nextElem.tagName === 'BUTTON') nextElem.click();
                else nextElem.focus();
            }
        }

        function checkLogin() {
            const u = document.getElementById('user_field').value;
            const p = document.getElementById('pass_field').value;
            
            if(u === adminUser && p === adminPass) {
                localStorage.setItem('last_user', u);
                document.getElementById('page_login').style.display = 'none';
                document.getElementById('main_ui').style.display = 'block';
                document.getElementById('btn_admin').style.display = 'block';
                renderUserList();
            } else {
                alert("Credenziali errate!");
            }
        }

        function showPage(id) {
            document.querySelectorAll('.container').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
        }

        function loadChecklist(turno) {
            const data = turniData[turno];
            let html = `<h3>Turno Selezionato: ${turno}</h3>`;
            
            for (let fase in data) {
                const tasks = data[fase];
                html += `
                    <div class="fase-box">
                        <div style="display:flex; justify-content:space-between;">
                            <strong>FASE: ${fase.toUpperCase()}</strong>
                            <span class="count-badge">${tasks.length} da completare</span>
                        </div>
                        ${tasks.map(task => `
                            <div class="check-item">
                                <input type="checkbox" onchange="markComplete(this)">
                                <div style="margin-left:10px;">
                                    <strong>${task.t}</strong><br>
                                    <small>${task.n} ${task.c ? ' - Codice: '+task.c : ''}</small>
                                </div>
                                <span class="time-stamp"></span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            document.getElementById('checklist_content').innerHTML = html;
        }

        function markComplete(cb) {
            const stamp = cb.parentElement.querySelector('.time-stamp');
            stamp.innerText = cb.checked ? new Date().toLocaleTimeString() : '';
            // Qui si può aggiornare il badge del conteggio
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('main_clock').innerText = now.toLocaleTimeString();
            document.getElementById('current_date').innerText = now.toLocaleDateString('it-IT', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
            
            document.getElementById('clock_zur').innerText = now.toLocaleTimeString('it-IT', {timeZone:'Europe/Zurich', hour:'2-digit', minute:'2-digit'});
            document.getElementById('clock_lon').innerText = now.toLocaleTimeString('it-IT', {timeZone:'Europe/London', hour:'2-digit', minute:'2-digit'});
            document.getElementById('clock_ny').innerText = now.toLocaleTimeString('it-IT', {timeZone:'America/New_York', hour:'2-digit', minute:'2-digit'});
        }

        function logout() { location.reload(); }
        
        // Funzioni Amministratore semplificate per demo
        function renderUserList() {
            const body = document.getElementById('user_list_body');
            body.innerHTML = users.map(u => `
                <tr>
                    <td>${u.email}</td>
                    <td>${u.lvl}</td>
                    <td>${u.status}</td>
                    <td><button onclick="alert('Modifica in corso...')">Gestisci</button></td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
