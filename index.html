<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V 1.2 BETA</title>
    <style>
        :root { --blue: #003366; --red: #e30613; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }
        
        /* Login Style */
        #page_login { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: var(--blue); display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        
        /* Header & Graphics */
        .header { text-align: center; padding: 20px; background: var(--white); border-bottom: 5px solid var(--red); }
        .logo-consorzio { height: 100px; margin-bottom: 10px; }
        .logo-securitas { height: 40px; }
        .version-label { color: var(--blue); font-weight: bold; margin-top: 10px; }

        /* Dashboard */
        .dashboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; background: white; margin: 20px; border-radius: 15px; }
        .clock-big { font-size: 3rem; font-weight: bold; color: var(--blue); display: block; }
        .world-clocks { display: flex; gap: 15px; font-size: 0.9rem; color: #555; }
        .meteo-widget { background: #e0f2f1; padding: 15px; border-radius: 10px; border-left: 5px solid #009688; }

        /* Navigation */
        .main-nav { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; }
        .nav-btn { height: 80px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-checklist { background: var(--blue); }
        .btn-admin { background: #333; }
        .btn-badge { background: var(--red); }

        /* Sections */
        .container { display: none; padding: 20px; max-width: 1100px; margin: auto; }
        .active-page { display: block; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }

        /* Table & Forms */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* Checklist UI */
        .fase-header { background: #f0f0f0; padding: 10px; margin-top: 20px; border-left: 5px solid var(--red); display: flex; justify-content: space-between; align-items: center; }
        .check-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #eee; transition: background 0.2s; }
        .check-item:hover { background: #f9f9f9; }
        .timestamp { margin-left: auto; font-family: monospace; color: var(--red); font-weight: bold; }
        .badge-count { background: var(--blue); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="page_login">
        <div class="login-card">
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" width="150" style="margin-bottom: 20px;">
            <h3>Accesso NSIF</h3>
            <input type="text" id="login_user" placeholder="E-mail" onkeypress="handleEnter(event, 'login_pass')">
            <input type="password" id="login_pass" placeholder="Password" onkeypress="handleEnter(event, 'btn_login_confirm')">
            <button id="btn_login_confirm" class="nav-btn btn-badge" style="width: 100%; height: 50px;" onclick="doLogin()">CONFERMA</button>
            <p><a href="#" style="font-size: 0.8rem; color: #666;">Password dimenticata?</a></p>
        </div>
    </div>

    <div id="main_interface" style="display:none;">
        <div class="header">
            <img src="logo_consorzio.jpg" class="logo-consorzio" alt="LOGO CONSORZIO" onerror="this.src='https://via.placeholder.com/200x100?text=Logo+Consorzio'">
            <br>
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" class="logo-securitas">
            <div class="version-label">NSFI CASTIONE ‚Äì GESTIONALE V 1.2 BETA</div>
        </div>

        <div class="dashboard">
            <div style="text-align: center;">
                <div id="date_today" style="font-weight: bold; font-size: 1.2rem;">Luned√¨, 16 Febbraio 2026</div>
                <div id="main_clock" class="clock-big">08:30:00</div>
            </div>
            <div class="world-clocks">
                <div>Zurigo: <span id="tz_zur">08:30</span></div>
                <div>Londra: <span id="tz_lon">07:30</span></div>
                <div>N. York: <span id="tz_nyc">02:30</span></div>
            </div>
            <div class="meteo-widget">
                <strong>METEO CASTIONE</strong><br>
                <span>‚òÄÔ∏è Sereno, 8¬∞C</span><br>
                <small>Vento: 5 km/h N</small>
            </div>
        </div>

        <div class="main-nav">
            <button class="nav-btn btn-checklist" onclick="showSection('section_checklist')">üìã CHECKLIST TURNI</button>
            <button class="nav-btn btn-badge" onclick="showSection('section_badge')">üõÇ GESTIONE BADGE</button>
            <button id="nav_admin" class="nav-btn btn-admin" style="display:none;" onclick="showSection('section_admin')">‚öôÔ∏è PANNELLO AMMINISTRATORE</button>
            <button class="nav-btn" style="background:#666;" onclick="logout()">LOGOUT</button>
        </div>

        <div id="section_checklist" class="container">
            <div class="card">
                <h2>Seleziona Turno</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T1')">TURNO T1 (06:00-15:00)</button>
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T2')">TURNO T2 (14:45-22:00)</button>
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T3')">TURNO T3 (Notturno/Speciale)</button>
                </div>
                <div id="checklist_render_area"></div>
            </div>
        </div>

        <div id="section_admin" class="container">
            <div class="card">
                <h2>‚öôÔ∏è Gestione Account</h2>
                <table id="table_accounts">
                    <thead><tr><th>Email</th><th>Livello</th><th>Stato</th><th>Scadenza</th><th>Azioni</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // DATA FROM WORD DOCUMENTS
        const checklistData = {
            T1: {
                inizio: [
                    {t: "Aprire cancello Campo Base Nord", c: "6988", n: ""},
                    {t: "Parcheggiare auto Coordinamento", c: "", n: "Posto tutto a destra"},
                    {t: "Aprire ufficio Campo Base Nord", c: "1907", n: ""},
                    {t: "Alzare tapparelle", c: "", n: ""},
                    {t: "Verificare riscaldamento", c: "", n: "Pos. 4 inverno / spento estate"},
                    {t: "Accendere telefono servizio", c: "PIN 6681 / Sblocco 1907", n: "Tenerlo fino arrivo T3"},
                    {t: "Accendere radio e prova collegamento", c: "Canale 15", n: ""},
                    {t: "Aprire cancello pedonale", c: "6988", n: ""},
                    {t: "Recarsi al CAST07 e apertura", c: "1907", n: ""},
                    {t: "Verifica tornelli e luci", c: "", n: ""},
                    {t: "Verifica carica monopattino", c: "", n: "Verde = Carico"},
                    {t: "Sbloccare PC e verifica E-mail", c: "", n: "Password in mappetta gialla"},
                    {t: "Aprire VTI External", c: "", n: "Sharing documenti"}
                ],
                durante: [
                    {t: "Verifica attraversamento operai", c: "", n: "06:45-07:00 / 11:55-12:05 / 16:30-17:00"},
                    {t: "Presidio CAST08 (su richiesta)", c: "", n: "Registrare Nome, Azienda, Targa, Ora"},
                    {t: "Compilare Giornale di bordo", c: "", n: ""},
                    {t: "Pulizia postazione", c: "", n: ""},
                    {t: "Verifica DPI operai", c: "", n: "Casco e Gilet obbligatori"}
                ],
                fine: [
                    {t: "Pulizia ufficio e straccio a terra", c: "", n: "CAST07"},
                    {t: "Passaggio di consegna", c: "", n: "CAST09 - Max 15 minuti"}
                ]
            },
            T2: {
                inizio: [
                    {t: "Aprire cancelli entrata/uscita CAST09", c: "6988", n: ""},
                    {t: "Aprire ufficio CAST09", c: "1907", n: ""},
                    {t: "Alzare tapparelle e serrande tornello", c: "", n: ""},
                    {t: "Verifica riscaldamento", c: "", n: "Leva 3/4 inverno"},
                    {t: "Verifica tornelli, barriera e luci", c: "", n: "Pulire fotocellule se necessario"},
                    {t: "Campo Base Sud apertura", c: "", n: "Chiave in Keybox interno baracca"},
                    {t: "Sbloccare PC (Mappetta Rossa)", c: "", n: ""}
                ],
                durante: [
                    {t: "Presidio CAST09", c: "", n: "Registrazione mezzi e verifica DPI"},
                    {t: "Giornale di bordo e sospesi", c: "", n: ""},
                    {t: "Verifica allacciamenti elettrici", c: "", n: "No prolunghe esterne al quadro"}
                ],
                fine: [
                    {t: "Pulizia postazione", c: "", n: "Straccio superfici"},
                    {t: "Passaggio di consegna", c: "", n: "CAST09"},
                    {t: "Passare straccio a terra", c: "", n: "Entro le 22:00"}
                ]
            },
            T3: {
                inizio: [
                    {t: "Parcheggiare al centro (Coordinamento)", c: "", n: ""},
                    {t: "Prova radio colleghi", c: "Canale 15", n: ""},
                    {t: "Ritiro telefono servizio al CAST07", c: "", n: ""},
                    {t: "Giro perimetro per divergenze", c: "", n: "Prendere monopattino dal CAST09"}
                ],
                durante: [
                    {t: "Supporto colleghi postazioni", c: "", n: ""},
                    {t: "Controllo regolarmente CAST08", c: "", n: "Verificare che non sia aperto senza presidio"},
                    {t: "Giro pausa pranzo (12:00-13:00)", c: "", n: "Nessun operaio deve mangiare in cantiere"},
                    {t: "Verifica accessibilit√† ambulanza", c: "", n: "Assicurarsi che non ci siano ostruzioni"}
                ],
                fine: [
                    {t: "Verifica assenza operai (Bausicht)", c: "", n: ""},
                    {t: "Chiusura cancelli CAST09", c: "6988", n: ""},
                    {t: "Chiusura Campo Base Sud", c: "", n: "Aprire leggermente rubinetti (inverno)"},
                    {t: "Chiusura perimetro completo", c: "", n: ""},
                    {t: "Verifica chiusura uffici CSC", c: "6990", n: "Luci spente e finestre chiuse"},
                    {t: "Controllo bagni Securitas", c: "", n: "Chiudere a chiave"}
                ]
            }
        };

        let accounts = [{email: 'marco.lamorgia', pass: '1234', lvl: 'admin', status: 'ATTIVO', expiry: 999}];

        // SYSTEM LOGIC
        window.onload = () => {
            const savedUser
