<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V4.8.1 BETA</title>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f0f2f5; --glass: rgba(255, 255, 255, 0.9); }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        
        /* Header & Logo */
        .main-header { text-align: center; padding: 20px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo-large { width: 180px; margin-bottom: 10px; }
        .logo-securitas { width: 120px; display: block; margin: 0 auto; }
        .version-title { font-size: 1.2rem; font-weight: bold; color: var(--securitas-blue); margin-top: 10px; }

        /* Dashboard & Clocks */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; background: #fff; margin: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .widget { text-align: center; padding: 10px; border-right: 1px solid #eee; }
        .widget:last-child { border-right: none; }
        #main-clock { font-size: 2.5rem; font-weight: bold; color: var(--securitas-red); display: block; }
        .world-clocks { display: flex; justify-content: space-around; font-size: 0.8rem; margin-top: 10px; color: #666; }

        /* Navigation */
        .container { width: 95%; max-width: 1000px; margin: 0 auto; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .btn-main { height: 100px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; display: flex; align-items: center; justify-content: center; text-transform: uppercase; }
        .btn-blue { background: var(--securitas-blue); }
        .btn-red { background: var(--securitas-red); }
        .btn-dark { background: #333; }
        .btn-main:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* Pages */
        .page { display: none; background: white; padding: 30px; border-radius: 15px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Tables & Forms */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #f8f9fa; }
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; }
        
        .external-links-area { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px; border: 2px dashed #003366; }
        .link-buttons-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .btn-link { background: white; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        .checklist-item { display: flex; align-items: flex-start; padding: 15px; border-bottom: 1px solid #eee; gap: 15px; }
        .time-badge { margin-left: auto; color: var(--success); font-weight: bold; background: #e8f5e9; padding: 5px 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="main-header">
    <img src="logo_nsif_grande.jpg" class="logo-large" alt="NSIF LOGO" onerror="this.src='https://via.placeholder.com/180x80?text=NSIF+LOGO'">
    <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" class="logo-securitas" alt="Securitas">
    <div class="version-title">NSIF CASTIONE ‚Äì GESTIONALE V4.8.1 BETA</div>
</div>

<div class="container">
    <div id="page_home" class="active">
        <div class="dashboard">
            <div class="widget">
                <span id="current-date" style="font-weight: bold; font-size: 1.2rem;"></span>
                <span id="main-clock">00:00:00</span>
            </div>
            <div class="widget">
                <strong>METEO CASTIONE</strong><br>
                <span>‚òÄÔ∏è 14¬∞C - Sereno</span>
            </div>
            <div class="widget">
                <strong>FUSI ORARI</strong>
                <div class="world-clocks">
                    <div>LON: <span id="clock-lon"></span></div>
                    <div>NYC: <span id="clock-nyc"></span></div>
                    <div>TYO: <span id="clock-tyo"></span></div>
                </div>
            </div>
        </div>

        <div class="menu-grid">
            <button class="btn-main btn-red" onclick="app.showPage('page_checklist')">üìã CHECKLIST TURNI</button>
            <button class="btn-main btn-blue" onclick="app.showPage('page_badge')">üõÇ GESTIONE BADGE</button>
            <button id="admin_btn" class="btn-main btn-dark" style="display:none;" onclick="app.showPage('page_admin')">‚öôÔ∏è PANNELLO AMMINISTRATORE</button>
        </div>

        <div class="external-links-area">
            <strong>üîó COLLEGAMENTI ESTERNI Rapidi</strong>
            <div id="main_link_container" class="link-buttons-container"></div>
        </div>
    </div>

    <div id="page_login" class="page">
        <h2>Accesso al Sistema</h2>
        <input type="text" id="login_email" placeholder="E-mail">
        <input type="password" id="login_pass" placeholder="Password">
        <button class="btn-main btn-blue" onclick="auth.login()">ACCEDI</button>
    </div>

    <div id="page_admin" class="page">
        <button class="btn-link" onclick="app.showPage('page_home')">‚Üê TORNA ALLA HOME</button>
        <h2>‚öôÔ∏è Amministrazione</h2>
        
        <div class="admin-section">
            <h3>üë• GESTIONE ACCOUNT</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                <input type="email" id="adm_email" placeholder="E-mail">
                <input type="text" id="adm_pass" placeholder="Password">
                <select id="adm_level">
                    <option value="admin">Admin</option>
                    <option value="superuser">Superuser</option>
                    <option value="user">User</option>
                    <option value="guest">Guest</option>
                </select>
                <input type="number" id="adm_days" placeholder="Durata (giorni)">
                <button class="btn-main btn-blue" style="height: 40px;" onclick="admin.addUser()">AGGIUNGI ACCOUNT</button>
            </div>
            <table id="user_table">
                <thead><tr><th>E-mail</th><th>Livello</th><th>Scadenza</th><th>Stato</th><th>Azioni</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="admin-section" style="margin-top:40px;">
            <h3>üîó GESTIONE LINK ESTERNI</h3>
            <input type="text" id="link_name" placeholder="Nome del collegamento">
            <input type="text" id="link_url" placeholder="URL (es: https://...)">
            <button class="btn-main btn-blue" style="height: 40px;" onclick="admin.addLink()">AGGIUNGI LINK</button>
        </div>

        <div class="admin-section" style="margin-top:40px;">
            <h3>üìù CONFIGURAZIONE CHECKLIST</h3>
            <select id="task_turno"><option value="T1">Turno T1</option><option value="T2">Turno T2</option><option value="T3">Turno T3</option></select>
            <select id="task_fase"><option value="prima">Prima</option><option value="inizio">Inizio</option><option value="durante">Durante</option><option value="fine">Fine</option></select>
            <input type="text" id="task_title" placeholder="Titolo attivit√†">
            <input type="text" id="task_codes" placeholder="Codici apertura">
            <textarea id="task_note" placeholder="Note aggiuntive"></textarea>
            <button class="btn-main btn-blue" style="height: 40px;" onclick="admin.addTask()">AGGIUNGI ATTIVIT√Ä</button>
        </div>
    </div>

    <div id="page_checklist" class="page">
        <button class="btn-link" onclick="app.showPage('page_home')">‚Üê TORNA ALLA HOME</button>
        <h2>üìã Seleziona Turno</h2>
        <div class="menu-grid">
            <button class="btn-main btn-blue" onclick="checklist.render('T1')">TURNO T1</button>
            <button class="btn-main btn-blue" onclick="checklist.render('T2')">TURNO T2</button>
            <button class="btn-main btn-blue" onclick="checklist.render('T3')">TURNO T3</button>
        </div>
        <div id="checklist_content"></div>
    </div>
</div>

<script>
    // DATA STORAGE
    let users = JSON.parse(localStorage.getItem('nsif_users')) || [
        {u: "marco.lamorgia@securitas.ch", p: "1234", l: "admin", d: 365, s: "ATTIVO"}
    ];
    let links = JSON.parse(localStorage.getItem('nsif_links')) || [];
    let tasks = JSON.parse(localStorage.getItem('nsif_tasks')) || {
        T1: { prima: [], inizio: [{t:"Apertura cancello Nord", n:"Codice 6988", c:"6988"}], durante: [], fine: [] },
        T2: { prima: [], inizio: [], durante: [], fine: [] },
        T3: { prima: [], inizio: [], durante: [], fine: [] }
    };

    const app = {
        showPage: (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page_home').classList.remove('active');
            document.getElementById(id).classList.add('active');
        },
        updateClocks: () => {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('it-IT', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('main-clock').innerText = now.toLocaleTimeString('it-IT');
            document.getElementById('clock-lon').innerText = new Date().toLocaleTimeString('it-IT', {timeZone:'Europe/London', hour:'2-digit', minute:'2-digit'});
            document.getElementById('clock-nyc').innerText = new Date().toLocaleTimeString('it-IT', {timeZone:'America/New_York', hour:'2-digit', minute:'2-digit'});
            document.getElementById('clock-tyo').innerText = new Date().toLocaleTimeString('it-IT', {timeZone:'Asia/Tokyo', hour:'2-digit', minute:'2-digit'});
        }
    };

    const auth = {
        currentUser: null,
        login: () => {
            const u = document.getElementById('login_email').value;
            const p = document.getElementById('login_pass').value;
            const user = users.find(x => x.u === u && x.p === p && x.s === "ATTIVO");
            if(user) {
                auth.currentUser = user;
                if(user.l === "admin") document.getElementById('admin_btn').style.display = 'flex';
                app.showPage('page_home');
                admin.renderLinks();
            } else { alert("Accesso negato."); }
        }
    };

    const admin = {
        addUser: () => {
            const u = document.getElementById('adm_email').value;
            const p = document.getElementById('adm_pass').value;
            const l = document.getElementById('adm_level').value;
            const d = document.getElementById('adm_days').value;
            if(u && p) {
                users.push({u, p, l, d, s: "ATTIVO"});
                admin.save();
                admin.renderUsers();
            }
        },
        save: () => {
            localStorage.setItem('nsif_users', JSON.stringify(users));
            localStorage.setItem('nsif_links', JSON.stringify(links));
            localStorage.setItem('nsif_tasks', JSON.stringify(tasks));
        },
        renderUsers: () => {
            const tbody = document.querySelector('#user_table tbody');
            tbody.innerHTML = users.map((x, i) => `
                <tr>
                    <td>${x.u}</td>
                    <td>${x.l}</td>
                    <td>${x.d} gg</td>
                    <td><strong style="color:${x.s==='ATTIVO'?'green':'red'}">${x.s}</strong></td>
                    <td>
                        <button onclick="admin.toggleUser(${i})">B/S</button>
                        <button onclick="admin.delUser(${i})">ELIMINA</button>
                    </td>
                </tr>
            `).join('');
        },
        toggleUser: (i) => { users[i].s = users[i].s === "ATTIVO" ? "DISATTIVATO" : "ATTIVO"; admin.save(); admin.renderUsers(); },
        delUser: (i) => { users.splice(i,1); admin.save(); admin.renderUsers(); },
        addLink: () => {
            const name = document.getElementById('link_name').value;
            const url = document.getElementById('link_url').value;
            if(name && url) { links.push({name, url}); admin.save(); admin.renderLinks(); }
        },
        renderLinks: () => {
            const cont = document.getElementById('main_link_container');
            cont.innerHTML = links.map(l => `<button class="btn-link" onclick="window.open('${l.url}', '_blank')">${l.name}</button>`).join('');
        },
        addTask: () => {
            const t = document.getElementById('task_turno').value;
            const f = document.getElementById('task_fase').value;
            const title = document.getElementById('task_title').value;
            const codes = document.getElementById('task_codes').value;
            const note = document.getElementById('task_note').value;
            if(title) { tasks[t][f].push({t: title, n: note, c: codes}); admin.save(); }
        }
    };

    const checklist = {
        render: (turno) => {
            const cont = document.getElementById('checklist_content');
            let html = `<h3>CHECKLIST ${turno}</h3>`;
            ['prima', 'inizio', 'durante', 'fine'].forEach(fase => {
                const faseTasks = tasks[turno][fase];
                html += `<div style="margin-top:20px; border-bottom: 2px solid var(--securitas-blue);">
                            <strong>FASE: ${fase.toUpperCase()}</strong> (Mancanti: ${faseTasks.length})
                         </div>`;
                faseTasks.forEach((item, i) => {
                    html += `
                        <div class="checklist-item">
                            <input type="checkbox" style="width:25px; height:25px;" onchange="this.nextElementSibling.style.display = this.checked ? 'block' : 'none';">
                            <div class="time-badge" style="display:none;">${new Date().toLocaleTimeString()}</div>
                            <div>
                                <strong>${item.t}</strong> <span style="color:red"> [${item.c}]</span><br>
                                <small>${item.n}</small>
                            </div>
                        </div>
                    `;
                });
            });
            cont.innerHTML = html;
        }
    };

    setInterval(app.updateClocks, 1000);
    // Avvia con login
    window.onload = () => { app.showPage('page_login'); admin.renderUsers(); };
</script>

</body>
</html>
