<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione Hub - V2.5</title>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f4f7f9; --success: #28a745; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; color: #333; }
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 1px solid #ddd; }
        .banner-top { width: 100%; max-width: 800px; height: auto; display: block; margin: 0 auto; }
        .header { width: 100%; background: white; padding: 10px 0; text-align: center; border-bottom: 5px solid var(--securitas-red); }
        .logo-securitas { height: 30px; }
        .version-label { font-size: 0.75rem; font-weight: bold; color: var(--securitas-blue); margin-top: 5px; }
        .container { width: 95%; max-width: 900px; margin: 20px auto; padding-bottom: 60px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: none; text-align: center; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Dashboard & Clocks */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .widget { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-top: 3px solid var(--securitas-blue); }
        .clock { font-size: 1.1rem; font-weight: bold; color: var(--securitas-red); }
        .big-date { font-size: 1.8rem; font-weight: 800; color: var(--securitas-blue); margin: 20px 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* Menu Items */
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; }
        .menu-item { padding: 20px; background: white; border-radius: 12px; cursor: pointer; transition: 0.3s; border: 1px solid #eee; font-weight: bold; display: flex; align-items: center; justify-content: center; min-height: 50px; }
        .menu-item:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: var(--securitas-red); }
        .link-item { background: #f8f9fa; border-left: 5px solid var(--securitas-blue); }

        /* Buttons */
        button { width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 8px; background-color: var(--securitas-blue); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-red { background: var(--securitas-red); }
        .btn-gray { background: #6c757d; }
        
        /* Check-list specific */
        .checklist-item { text-align: left; padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .checklist-item input[type="checkbox"] { transform: scale(1.5); cursor: pointer; }
        .timestamp { font-size: 0.75rem; color: var(--success); font-weight: bold; margin-left: auto; }
        .alert-banner { background: var(--securitas-red); color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; display: none; }
    </style>
</head>
<body onload="startTime()">

    <div class="banner-container"><img src="logo_nsif.jpg" alt="Banner" class="banner-top" onerror="this.style.display='none'"></div>
    <div class="header">
        <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" alt="Securitas" class="logo-securitas">
        <div class="version-label">NSIF CASTIONE HUB - VERSIONE 2.5</div>
    </div>

    <div class="container">
        <div id="step_login" class="card active">
            <h2>LOGIN SISTEMA</h2>
            <input type="text" id="login_user" placeholder="Email Utente" style="margin-bottom:10px; width:100%; padding:10px;">
            <input type="password" id="login_pass" placeholder="Password" style="margin-bottom:10px; width:100%; padding:10px;">
            <button onclick="handleLogin()">ACCEDI</button>
        </div>

        <div id="step_dashboard" class="card">
            <div class="dashboard-grid">
                <div class="widget"><div id="clock_locarno" class="clock"></div><small>Castione (CH)</small></div>
                <div class="widget"><div id="clock_ny" class="clock"></div><small>New York</small></div>
                <div class="widget"><div id="clock_tokyo" class="clock"></div><small>Tokyo</small></div>
                <div class="widget"><div style="font-size:1.1rem;">‚òÄÔ∏è 8¬∞C</div><small>Meteo</small></div>
            </div>
            <div id="date_now" class="big-date"></div>
            <div class="menu-grid">
                <div class="menu-item" onclick="showStep('step_menu_accessi')">üõÇ CONTROLLO ACCESSI</div>
                <div class="menu-item btn-red" style="color:white" onclick="showStep('step_checklist_menu')">üìã CHECK-LIST ATTIVIT√Ä</div>
                <div class="menu-item link-item" onclick="window.open('https://app.bausicht.com/site/cmfciguey0me7vv19a6aj915n/dashboard', '_blank')">üåê BAUSICHT</div>
                <div class="menu-item link-item" onclick="window.open('https://ssgwp.sharepoint.com/teams/TONCH_Collab_2_16/...', '_blank')">üìÅ VTI EXTERNAL</div>
                <div class="menu-item btn-red" id="admin_btn" style="display:none; color:white;" onclick="showAdminPanel()">‚öôÔ∏è ADMIN</div>
            </div>
            <button class="btn-gray" onclick="location.reload()">LOGOUT</button>
        </div>

        <div id="step_checklist_menu" class="card">
            <h2>SELEZIONA TURNO</h2>
            <button onclick="openChecklist('T1')">TURNO T1 (06:00 - 15:00)</button>
            <button onclick="openChecklist('T2')">TURNO T2 (14:45 - 22:00)</button>
            <button onclick="openChecklist('T3')">TURNO T3 (08:00 - 23:00)</button>
            <button class="btn-gray" onclick="showStep('step_dashboard')">INDIETRO</button>
        </div>

        <div id="step_checklist_view" class="card">
            <div id="checklist_alert" class="alert-banner">‚ö†Ô∏è ATTENZIONE: ATTIVIT√Ä MANCANTI ALLA CONCLUSIONE DEL TURNO</div>
            <h2 id="checklist_title">Check-list</h2>
            <div id="checklist_content"></div>
            <button class="btn-gray" onclick="showStep('step_checklist_menu')">TORNA AI TURNI</button>
        </div>

        <div id="step_menu_accessi" class="card">
            <h2>CONTROLLO ACCESSI</h2>
            <button onclick="alert('Flusso Azienda OFT...')">Azienda gestita da OFT</button>
            <button onclick="alert('Flusso Azienda FFS...')">Azienda gestita da FFS</button>
            <button class="btn-gray" onclick="showStep('step_dashboard')">INDIETRO</button>
        </div>
    </div>

    <script>
        const MASTER = { email: "marco.lamorgia@securitas.ch", pass: "1234NSIF" };
        const dataTasks = {
            T1: ["Apertura cancello Base Nord (Cod. 6988)", "Parcheggio auto Coordinamento", "Apertura ufficio Base Nord (Cod. 1907)", "Verifica riscaldamento uffici", "Accensione telefono servizio (Pin 6681)", "Prova radio (Canale 15)", "Apertura CAST07", "Passaggio di consegna CAST09"],
            T2: ["Apertura cancelli CAST09", "Apertura ufficio CAST09 (Cod. 1907)", "Verifica tornelli e barriere", "Verifica carica monopattino", "Controllo DPI entrate/uscite", "Pulizia postazione", "Passaggio di consegna CAST09", "Passare lo straccio a terra"],
            T3: ["Parcheggio auto Centro", "Ritiro telefono servizio CAST07", "Giro perlustrazione cantiere", "Controllo modulo cassettino nero", "Supporto colleghi postazioni", "Controllo CAST08 (chiuso/presidiato)", "Segnalazione contromano CAST09", "Verifica DPI operai"]
        };

        function startTime() {
            const now = new Date();
            document.getElementById('date_now').innerHTML = now.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }).toUpperCase();
            document.getElementById('clock_locarno').innerHTML = now.toLocaleTimeString('it-CH');
            document.getElementById('clock_ny').innerHTML = new Date().toLocaleTimeString('it-CH', {timeZone:'America/New_York'});
            document.getElementById('clock_tokyo').innerHTML = new Date().toLocaleTimeString('it-CH', {timeZone:'Asia/Tokyo'});
            setTimeout(startTime, 1000);
        }

        function handleLogin() {
            const u = document.getElementById('login_user').value;
            const p = document.getElementById('login_pass').value;
            if (u === MASTER.email && p === MASTER.pass) {
                document.getElementById('admin_btn').style.display = 'flex';
                showStep('step_dashboard');
            } else { alert("Dati errati"); }
        }

        function showStep(id) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function openChecklist(turno) {
            document.getElementById('checklist_title').innerText = "CHECK-LIST " + turno;
            const container = document.getElementById('checklist_content');
            container.innerHTML = "";
            dataTasks[turno].forEach((task, index) => {
                container.innerHTML += `
                    <div class="checklist-item">
                        <input type="checkbox" id="task_${turno}_${index}" onchange="toggleTask('${turno}', ${index})">
                        <label for="task_${turno}_${index}">${task}</label>
                        <span id="time_${turno}_${index}" class="timestamp"></span>
                    </div>`;
            });
            updateAlert(turno);
            showStep('step_checklist_view');
        }

        function toggleTask(turno, index) {
            const cb = document.getElementById(`task_${turno}_${index}`);
            const ts = document.getElementById(`time_${turno}_${index}`);
            if (cb.checked) {
                const now = new Date();
                ts.innerText = "Eseguito alle: " + now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
            } else {
                ts.innerText = "";
            }
            updateAlert(turno);
        }

        function updateAlert(turno) {
            const checkboxes = document.querySelectorAll('#checklist_content input[type="checkbox"]');
            const checked = document.querySelectorAll('#checklist_content input[type="checkbox"]:checked');
            const alertBanner = document.getElementById('checklist_alert');
            
            if (checked.length < checkboxes.length) {
                alertBanner.style.display = 'block';
                alertBanner.innerText = `‚ö†Ô∏è ATTENZIONE: ${checkboxes.length - checked.length} ATTIVIT√Ä MANCANTI ALLA CONCLUSIONE`;
            } else {
                alertBanner.style.display = 'none';
            }
        }
    </script>
</body>
</html>
