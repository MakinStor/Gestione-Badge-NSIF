<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione - Gestione Accessi V13</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; }
        
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 1px solid #ddd; }
        .banner-top { width: 100%; max-width: 800px; height: auto; display: block; margin: 0 auto; }
        .header { width: 100%; background: white; padding: 15px 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom: 5px solid var(--securitas-red); }
        .logo-securitas { height: 32px; }

        .container { width: 95%; max-width: 600px; margin: 20px auto; padding-bottom: 60px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: none; text-align: center; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--securitas-blue); font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; }
        
        button { width: 100%; padding: 16px; margin: 8px 0; border: none; border-radius: 8px; background-color: var(--securitas-blue); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); }
        .btn-red { background: var(--securitas-red); }
        .btn-gray { background: #6c757d; }

        .form-group { text-align: left; margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: var(--securitas-blue); }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }

        .instruction-card { background: #fff9db; border-left: 6px solid #fcc419; padding: 15px; text-align: left; font-size: 0.9rem; border-radius: 4px; margin-bottom: 15px; }
        .user-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.8rem; }
        .user-table td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>

    <div class="banner-container">
        <img src="logo_nsif.jpg" alt="Banner NSIF" class="banner-top" onerror="this.style.display='none'">
    </div>

    <div class="header">
        <img id="sec_logo_src" src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" alt="Securitas" class="logo-securitas">
        <div style="font-weight: bold; color: var(--securitas-blue); font-size: 0.9rem; margin-top:5px;">GESTIONE ACCESSI NSIF CASTIONE</div>
    </div>

    <div class="container">
        <div id="step_login" class="card active">
            <h2>Login</h2>
            <div class="form-group"><label>Email</label><input type="text" id="login_user" placeholder="marco.lamorgia@securitas.ch"></div>
            <div class="form-group"><label>Password</label><input type="password" id="login_pass"></div>
            <button onclick="handleLogin()">ACCEDI</button>
            <button class="btn-gray" onclick="alert('Contattare l\'amministratore per il recupero.')">Modifica / Recupera Password</button>
        </div>

        <div id="step_menu" class="card">
            <h2>Processi</h2>
            <button onclick="showStep('step_oft')">Collaboratore OFT</button>
            <button onclick="showStep('step_ffs')">Collaboratore FFS</button>
            <button class="btn-outline" onclick="showStep('step_speciali')">Badge Speciali / CPC Paritetica</button>
            
            <div id="admin_area" style="display:none; margin-top: 20px; border-top: 2px dashed #ccc; padding-top: 10px;">
                <button class="btn-red" onclick="showAdminPanel()">⚙️ GESTIONE UTENTI</button>
            </div>
            <button class="btn-gray" onclick="location.reload()" style="margin-top:20px;">LOGOUT</button>
        </div>

        <div id="step_speciali" class="card">
            <h2>Badge Speciali & CPC</h2>
            <button onclick="alert('Processo Visitatore: Seguire protocollo ritiro documento.')">Visitatore</button>
            <button onclick="alert('Processo Stampa: Verifica accredito Stampa-Radio-TV.')">Stampa - Radio - TV</button>
            <button class="btn-red" onclick="alert('CHIAMARE IMMEDIATAMENTE NIJAZ PEPELJAK')">CPC Paritetica</button>
            <button class="btn-gray" onclick="showStep('step_menu')">INDIETRO</button>
        </div>

        <div id="step_oft" class="card">
            <h2>OFT: Verifica</h2>
            <button onclick="showStep('step_modulo')">Situazione 1: Senza Immagine</button>
            <button class="btn-gray" onclick="showStep('step_menu')">INDIETRO</button>
        </div>

        <div id="step_modulo" class="card">
            <h2>Dati Modulo Ritiro</h2>
            <div class="form-group"><label>Azienda</label><input type="text" id="f_azienda"></div>
            <div class="form-group"><label>Cognome</label><input type="text" id="f_cognome"></div>
            <div class="form-group"><label>Nome</label><input type="text" id="f_nome"></div>
            <div class="form-group"><label>Numero Badge</label><input type="text" id="f_badge"></div>
            <button class="btn-red" onclick="generateModuloPDF()">GENERA PDF ORIGINALE</button>
        </div>

        <div id="step_fine" class="card">
            <h2>Modulo Generato</h2>
            <div class="instruction-card">
                • Consegnare a <b>Loris Zatta</b>.<br>
                • Mettere in cassetta per <b>La Morgia</b>.<br>
                • <b>T3</b> archivia.
            </div>
            <button onclick="showStep('step_menu')">FINE</button>
        </div>

        <div id="step_admin" class="card">
            <h2>Admin</h2>
            <div id="users_list"></div>
            <button class="btn-outline" onclick="showStep('step_menu')">CHIUDI</button>
        </div>
    </div>

    <script>
        const ADMIN_USER = "marco.lamorgia@securitas.ch";
        const ADMIN_PASS = "1234NSIF";

        function handleLogin() {
            const u = document.getElementById('login_user').value;
            const p = document.getElementById('login_pass').value;
            if(u === ADMIN_USER && p === ADMIN_PASS) {
                document.getElementById('admin_area').style.display = 'block';
                showStep('step_menu');
            } else { showStep('step_menu'); } // Semplificato per test
        }

        function showStep(id) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function generateModuloPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            const az = document.getElementById('f_azienda').value.toUpperCase();
            const cog = document.getElementById('f_cognome').value.toUpperCase();
            const nom = document.getElementById('f_nome').value.toUpperCase();
            const bdg = document.getElementById('f_badge').value;

            // 1. INTESTAZIONE (LOGO E TITOLO)
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            doc.text("Modulo ritiro Badge Identificativo", 105, 25, {align: 'center'});
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("Oggetto/mandato: Cantiere FFS - NSIF Castione", 20, 38);
            doc.text(`Data: ${new Date().toLocaleDateString('it-IT')}`, 160, 38);

            // 2. GRIGLIA DATI (Identica all'originale)
            doc.setLineWidth(0.4);
            doc.line(20, 45, 190, 45); // Top
            
            doc.setFont("helvetica", "bold");
            doc.text("Numero Badge", 25, 53); doc.setFont("helvetica", "normal"); doc.text(bdg, 70, 53);
            doc.line(20, 57, 190, 57);
            
            doc.setFont("helvetica", "bold");
            doc.text("AZIENDA", 25, 65); doc.setFont("helvetica", "normal"); doc.text(az, 70, 65);
            doc.line(20, 69, 190, 69);

            doc.setFont("helvetica", "bold");
            doc.text("Cognome", 25, 77); doc.setFont("helvetica", "normal"); doc.text(cog, 70, 77);
            doc.line(20, 81, 190, 81);

            doc.setFont("helvetica", "bold");
            doc.text("Nome", 25, 89); doc.setFont("helvetica", "normal"); doc.text(nom, 70, 89);
            doc.line(20, 93, 190, 93); // Bottom della tabella

            // 3. DICHIARAZIONE
            doc.setFontSize(11); doc.setFont("helvetica", "bold");
            doc.text("Dichiarazione e Accettazione", 20, 105);
            
            doc.setFontSize(9); doc.setFont("helvetica", "normal");
            const text = [
                "Con la presente, il sottoscritto dichiara di aver ricevuto il Badge identificativo per l'accesso al cantiere",
                "FFS NSIF di Castione e di essere a conoscenza delle seguenti condizioni:",
                "",
                "- Il badge è uno strumento di identificazione personale e non è cedibile a terzi.",
                "- In caso di perdita o smarrimento del badge, sarà applicata una tassa di CHF 50.00 per la sua riemissione.",
                "- Il furto o lo smarrimento del badge deve essere segnalato immediatamente all'ufficio sicurezza Securitas.",
                "- Si impegna a restituire il Badge alla cessazione del rapporto di lavoro o su richiesta dell'azienda,",
                "  in caso contrario sarà applicata una tassa di CHF 50.00.",
                "- Dichiara di acconsentire al trattamento dei dati personali come previsto dall'informativa sulla privacy."
            ];
            doc.text(text, 20, 112);

            // 4. FIRME
            doc.text("Luogo e Data: Castione, ________________", 20, 165);
            
            doc.setFont("helvetica", "bold");
            doc.text("Firma per accettazione", 20, 180);
            doc.text("Firma responsabile", 120, 180);
            doc.line(20, 195, 80, 195);
            doc.line(120, 195, 180, 195);

            // 5. AREA CONTROLLO (FOOTER)
            doc.setFillColor(245, 245, 245);
            doc.rect(20, 210, 170, 30, 'F');
            doc.rect(20, 210, 170, 30, 'S');
            
            doc.setFont("helvetica", "bold");
            doc.text("Controllo Securitas", 25, 218);
            doc.setFont("helvetica", "normal");
            doc.text("Data: ___________", 70, 218);
            doc.text("Visto: Marco La Morgia", 120, 218);
            doc.text("Verifica:   ok [  ]    Da verificare [  ]", 120, 230);

            doc.save(`Modulo_Ritiro_${cog}.pdf`);
            showStep('step_fine');
        }
    </script>
</body>
</html>
