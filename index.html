<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione - Gestione Accessi V4</title>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg-color: #f4f7f9; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 1px solid #ddd; }
        .banner-top { width: 100%; height: auto; max-height: 100px; object-fit: contain; display: block; margin: 0 auto; padding: 5px 0; }
        .header { width: 100%; background: white; padding: 10px 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom: 5px solid var(--securitas-red); }
        .logo-securitas { height: 30px; }
        .container { width: 95%; max-width: 550px; margin: 20px 0; flex-grow: 1; padding-bottom: 60px; }
        .step { display: none; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); text-align: center; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        h2 { color: var(--securitas-blue); font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; }
        input[type="password"] { width: 100%; max-width: 280px; padding: 15px; margin: 15px auto; border: 2px solid #ddd; border-radius: 8px; text-align: center; font-size: 1.1rem; display: block; box-sizing: border-box; }
        button { width: 100%; padding: 16px; margin: 8px 0; border: none; border-radius: 8px; background-color: var(--securitas-blue); color: white; font-size: 0.95rem; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); }
        .btn-gray { background: #6c757d; }
        .btn-logout { background: #333; font-size: 0.8rem; margin-top: 30px; }
        .instruction-card { background: #fff9db; border-left: 6px solid #fcc419; padding: 15px; text-align: left; margin-top: 15px; border-radius: 4px; font-size: 0.9rem; line-height: 1.6; color: #333; }
        .status-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; background: #e9ecef; font-size: 0.75rem; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="banner-container">
        <img src="logo_nsif.jpg" alt="Banner NSIF" class="banner-top" onerror="this.style.display='none'">
    </div>

    <div class="header">
        <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" alt="Securitas Logo" class="logo-securitas">
        <div style="font-weight: bold; color: var(--securitas-blue); font-size: 0.85rem;">NSIF Castione - Gestione Controllo Accessi V.4.0</div>
    </div>

    <div class="container">
        <div id="step_login" class="step">
            <h2>Accesso Riservato</h2>
            <input type="password" id="pass_input" placeholder="Password" onkeydown="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()">ACCEDI</button>
        </div>

        <div id="step_start" class="step">
            <h2>Nuova Registrazione</h2>
            <button onclick="nextStep('step_oft_check')">Registrazione collaboratore OFT</button>
            <button onclick="nextStep('step_ffs_check')">Registrazione collaboratore FFS</button>
            <button class="btn-outline" onclick="nextStep('step_visitatori')">Elaborazione "Badge Visitatore" / "Stampa"</button>
            <button class="btn-outline" onclick="nextStep('step_csc')">Elaborazione "CSC Paritetica"</button>
            <button class="btn-logout" onclick="logout()">LOGOUT</button>
        </div>

        <div id="step_oft_check" class="step">
            <div class="status-tag">OFT</div>
            <h2>Verifica Sistema Bausicht</h2>
            <button onclick="nextStep('step_oft_foto')">Presente nel sistema</button>
            <button class="btn-gray" onclick="showFinal('oft_non_presente')">NON presente nel sistema</button>
        </div>

        <div id="step_oft_foto" class="step">
            <div class="status-tag">OFT > Presente</div>
            <h2>Verifica Fotografia</h2>
            <button onclick="showFinal('oft_ok')">Foto presente</button>
            <button onclick="nextStep('step_oft_formazione')">Foto MANCANTE</button>
        </div>

        <div id="step_oft_formazione" class="step">
            <div class="status-tag">OFT > Foto Mancante</div>
            <h2>Verifica Formazione</h2>
            <p>Il collaboratore ha effettuato la formazione sicurezza?</p>
            <button onclick="nextStep('step_oft_situazione')">SÌ, formazione effettuata</button>
            <button class="btn-gray" onclick="showFinal('oft_no_formazione')">NO, formazione mancante</button>
        </div>

        <div id="step_oft_situazione" class="step">
            <div class="status-tag">OFT > Foto Mancante > Formato</div>
            <h2>Seleziona Situazione</h2>
            <button onclick="showFinal('oft_sit1')">Situazione 1 (Procedura Standard)</button>
            <button onclick="showFinal('oft_sit2')">Situazione 2 (Conferma Identità)</button>
        </div>

        <div id="step_ffs_check" class="step">
            <div class="status-tag">FFS</div>
            <h2>Verifica Sistema FFS</h2>
            <button onclick="nextStep('step_ffs_foto')">Presente nel sistema</button>
            <button class="btn-gray" onclick="showFinal('ffs_non_presente')">NON presente nel sistema</button>
        </div>

        <div id="step_ffs_foto" class="step">
            <div class="status-tag">FFS > Presente</div>
            <h2>Verifica Fotografia</h2>
            <button onclick="showFinal('ffs_ok')">Foto presente</button>
            <button onclick="showFinal('ffs_no_foto')">Foto MANCANTE</button>
        </div>

        <div id="step_visitatori" class="step">
            <h2>Badge Visitatore / Stampa</h2>
            <div class="instruction-card">
                1. Verifica annuncio (Lista/Mail)<br>
                2. Chiamare il referente della visita<br>
                3. Chiedere Documento d'Identità
            </div>
            <button onclick="showFinal('visitatori_ok')">Documento Ritirato</button>
            <button class="btn-outline" onclick="showFinal('visitatori_lista')">Presente Lista (No ritiro doc)</button>
        </div>

        <div id="step_csc" class="step">
            <h2>CSC Paritetica</h2>
            <p>Se non annunciati: chiedere dati da tessera di riconoscimento.</p>
            <button onclick="showFinal('csc_azione')">CHIAMARE NIJAZ PEPELJAK</button>
        </div>

        <div id="
