<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V 1.1 BETA</title>
    <style>
        :root { --blue: #003366; --red: #e30613; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }
        
        /* Login Style */
        #page_login { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: var(--blue); display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        
        /* Header & Graphics */
        .header { text-align: center; padding: 20px; background: var(--white); border-bottom: 5px solid var(--red); }
        .logo-consorzio { height: 100px; margin-bottom: 10px; }
        .logo-securitas { height: 40px; }
        .version-label { color: var(--blue); font-weight: bold; margin-top: 10px; }

        /* Dashboard */
        .dashboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; background: white; margin: 20px; border-radius: 15px; }
        .clock-big { font-size: 3rem; font-weight: bold; color: var(--blue); display: block; }
        .world-clocks { display: flex; gap: 15px; font-size: 0.9rem; color: #555; }
        .meteo-widget { background: #e0f2f1; padding: 15px; border-radius: 10px; border-left: 5px solid #009688; }

        /* Navigation */
        .main-nav { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; }
        .nav-btn { height: 80px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-checklist { background: var(--blue); }
        .btn-admin { background: #333; }
        .btn-badge { background: var(--red); }

        /* Sections */
        .container { display: none; padding: 20px; max-width: 1100px; margin: auto; }
        .active-page { display: block; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }

        /* Admin & Table */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .status-active { color: green; font-weight: bold; }
        .status-blocked { color: red; font-weight: bold; }

        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* External Links */
        .links-section { margin-top: 30px; padding: 20px; background: #eee; border-radius: 10px; }
        .link-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .url-btn { background: white; border: 2px solid var(--blue); color: var(--blue); padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* Checklist UI */
        .fase-header { background: #f0f0f0; padding: 10px; margin-top: 20px; border-left: 5px solid var(--red); display: flex; justify-content: space-between; }
        .check-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .timestamp { margin-left: auto; font-family: monospace; color: #666; font-size: 0.85rem; }
    </style>
</head>
<body>

    <div id="page_login">
        <div class="login-card">
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" width="150" style="margin-bottom: 20px;">
            <h3>Accesso NSIF</h3>
            <input type="text" id="login_user" placeholder="E-mail" onkeypress="handleEnter(event, 'login_pass')">
            <input type="password" id="login_pass" placeholder="Password" onkeypress="handleEnter(event, 'btn_login_confirm')">
            <button id="btn_login_confirm" class="nav-btn btn-badge" style="width: 100%; height: 50px;" onclick="doLogin()">CONFERMA</button>
            <p><a href="#" style="font-size: 0.8rem; color: #666;">Password dimenticata?</a></p>
        </div>
    </div>

    <div id="main_interface" style="display:none;">
        <div class="header">
            <img src="logo_consorzio.jpg" class="logo-consorzio" alt="LOGO CONSORZIO" onerror="this.src='https://via.placeholder.com/200x100?text=Logo+Consorzio'">
            <br>
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" class="logo-securitas">
            <div class="version-label">NSFI CASTIONE ‚Äì GESTIONALE V 1.1 BETA</div>
        </div>

        <div class="dashboard">
            <div style="text-align: center;">
                <div id="date_today" style="font-weight: bold; font-size: 1.2rem;">Luned√¨, 16 Febbraio 2026</div>
                <div id="main_clock" class="clock-big">08:30:00</div>
            </div>
            <div class="world-clocks">
                <div>Zurigo: <span id="tz_zur">08:30</span></div>
                <div>Londra: <span id="tz_lon">07:30</span></div>
                <div>N. York: <span id="tz_nyc">02:30</span></div>
            </div>
            <div class="meteo-widget">
                <strong>METEO CASTIONE</strong><br>
                <span>‚òÄÔ∏è Sereno, 8¬∞C</span><br>
                <small>Vento: 5 km/h N</small>
            </div>
        </div>

        <div class="main-nav">
            <button class="nav-btn btn-checklist" onclick="showSection('section_checklist')">üìã CHECKLIST TURNI</button>
            <button class="nav-btn btn-badge" onclick="showSection('section_badge')">üõÇ GESTIONE BADGE</button>
            <button id="nav_admin" class="nav-btn btn-admin" style="display:none;" onclick="showSection('section_admin')">‚öôÔ∏è PANNELLO AMMINISTRATORE</button>
            <button class="nav-btn" style="background:#666;" onclick="logout()">LOGOUT</button>
        </div>

        <div class="links-section">
            <strong>üîó COLLEGAMENTI ESTERNI</strong>
            <div id="link_container" class="link-grid" style="margin-top:10px;"></div>
        </div>

        <div id="section_checklist" class="container">
            <div class="card">
                <h2>Seleziona Turno</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T1')">T1 (06:00-15:00)</button>
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T2')">T2 (14:45-22:00)</button>
                    <button class="nav-btn btn-checklist" onclick="renderChecklist('T3')">T3 (Notturno/Speciale)</button>
                </div>
                <div id="checklist_render_area"></div>
            </div>
        </div>

        <div id="section_admin" class="container">
            <div class="card">
                <h2>‚öôÔ∏è Gestione Account</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;">
                    <input type="text" id="adm_email" placeholder="E-mail">
                    <input type="text" id="adm_pass" placeholder="Password">
                    <select id="adm_lvl">
                        <option value="user">User</option>
                        <option value="superuser">Superuser</option>
                        <option value="admin">Admin</option>
                        <option value="guest">Guest</option>
                    </select>
                    <input type="number" id="adm_days" placeholder="Durata (gg)">
                </div>
                <button class="nav-btn btn-checklist" style="height: 40px; margin-top: 10px;" onclick="addAccount()">AGGIUNGI ACCOUNT</button>
                
                <table id="table_accounts">
                    <thead><tr><th>Email</th><th>Livello</th><th>Stato</th><th>Scadenza</th><th>Azioni</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card">
                <h2>üîó Configurazione Link Esterni</h2>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="cfg_link_name" placeholder="Nome Collegamento">
                    <input type="text" id="cfg_link_url" placeholder="URL (https://...)">
                </div>
                <button class="nav-btn btn-checklist" style="height: 40px;" onclick="saveExternalLink()">SALVA LINK</button>
            </div>

            <div class="card">
                <h2>üìù Configurazione Checklist Attivit√†</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <select id="cfg_chk_turno"><option value="T1">T1</option><option value="T2">T2</option><option value="T3">T3</option></select>
                    <select id="cfg_chk_fase"><option value="prima">Prima</option><option value="inizio">Inizio</option><option value="durante">Durante</option><option value="fine">Fine</option></select>
                </div>
                <input type="text" id="cfg_chk_titolo" placeholder="Titolo attivit√†">
                <input type="text" id="cfg_chk_codici" placeholder="Codici apertura">
                <textarea id="cfg_chk_note" placeholder="Note operative"></textarea>
                <button class="nav-btn btn-checklist" style="height: 40px;" onclick="saveChecklistTask()">AGGIUNGI ATTIVIT√Ä</button>
            </div>
        </div>
    </div>

    <script>
        // DATA STRUCTURES
        let accounts = JSON.parse(localStorage.getItem('nsif_accounts')) || [
            {email: 'admin', pass: '1234', lvl: 'admin', status: 'ATTIVO', expiry: 999}
        ];
        let externalLinks = JSON.parse(localStorage.getItem('nsif_links')) || [
            {name: "VTI External", url: "https://ssgwp.sharepoint.com/..."}
        ];
        let checklistData = JSON.parse(localStorage.getItem('nsif_checklists')) || {
            T1: { prima: [], inizio: [{t: "Aprire cancello Campo Base Nord", n: "Codice 6988", c: "6988"}], durante: [], fine: [] },
            T2: { prima: [], inizio: [], durante: [], fine: [] },
            T3: { prima: [], inizio: [], durante: [], fine: [] }
        };

        // LOGIN LOGIC
        window.onload = () => {
            const savedUser = localStorage.getItem('last_user');
            if(savedUser) document.getElementById('login_user').value = savedUser;
            updateTime();
            setInterval(updateTime, 1000);
            renderLinks();
        };

        function handleEnter(e, nextId) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const nextElem = document.getElementById(nextId);
                if(nextElem.tagName === 'BUTTON') nextElem.click();
                else nextElem.focus();
            }
        }

        function doLogin() {
            const u = document.getElementById('login_user').value;
            const p = document.getElementById('login_pass').value;
            const found = accounts.find(a => a.email === u && a.pass === p && a.status === 'ATTIVO');
            
            if(found) {
                localStorage.setItem('last_user', u);
                document.getElementById('page_login').style.display = 'none';
                document.getElementById('main_interface').style.display = 'block';
                if(found.lvl === 'admin') document.getElementById('nav_admin').style.display = 'flex';
                renderAccounts();
            } else {
                alert("Accesso fallito. Controllare credenziali o stato account.");
            }
        }

        function logout() { location.reload(); }

        // NAVIGATION
        function showSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
        }

        // TIME & DASHBOARD
        function updateTime() {
            const now = new Date();
            const itDate = now.toLocaleDateString('it-IT', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('date_today').innerText = itDate;
            document.getElementById('main_clock').innerText = now.toLocaleTimeString('it-IT');
            
            document.getElementById('tz_zur').innerText = now.toLocaleTimeString('it-IT', {timeZone: 'Europe/Zurich', hour: '2-digit', minute:'2-digit'});
            document.getElementById('tz_lon').innerText = now.toLocaleTimeString('it-IT', {timeZone: 'Europe/London', hour: '2-digit', minute:'2-digit'});
            document.getElementById('tz_nyc').innerText = now.toLocaleTimeString('it-IT', {timeZone: 'America/New_York', hour: '2-digit', minute:'2-digit'});
        }

        // ADMIN FUNCTIONS
        function renderAccounts() {
            const tbody = document.querySelector('#table_accounts tbody');
            tbody.innerHTML = '';
            accounts.forEach((acc, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${acc.email}</td>
                        <td>${acc.lvl}</td>
                        <td class="${acc.status === 'ATTIVO' ? 'status-active' : 'status-blocked'}">${acc.status}</td>
                        <td>${acc.expiry} gg</td>
                        <td>
                            <button onclick="toggleAccount(${index})">Blocca/Sblocca</button>
                            <button onclick="deleteAccount(${index})">X</button>
                        </td>
                    </tr>
                `;
            });
        }

        function addAccount() {
            const email = document.getElementById('adm_email').value;
            const pass = document.getElementById('adm_pass').value;
            const lvl = document.getElementById('adm_lvl').value;
            const days = document.getElementById('adm_days').value;
            if(!email || !pass) return;
            accounts.push({email, pass, lvl, status: 'ATTIVO', expiry: days || 30});
            saveAll(); renderAccounts();
        }

        function toggleAccount(i) {
            accounts[i].status = accounts[i].status === 'ATTIVO' ? 'DISATTIVATO' : 'ATTIVO';
            saveAll(); renderAccounts();
        }

        function deleteAccount(i) {
            if(confirm("Eliminare account?")) { accounts.splice(i,1); saveAll(); renderAccounts(); }
        }

        // EXTERNAL LINKS
        function saveExternalLink() {
            const name = document.getElementById('cfg_link_name').value;
            const url = document.getElementById('cfg_link_url').value;
            if(name && url) {
                externalLinks.push({name, url});
                saveAll(); renderLinks();
            }
        }

        function renderLinks() {
            const container = document.getElementById('link_container');
            container.innerHTML = '';
            externalLinks.forEach(l => {
                container.innerHTML += `<button class="url-btn" onclick="window.open('${l.url}', '_blank')">${l.name}</button>`;
            });
        }

        // CHECKLIST RENDERING
        function renderChecklist(turno) {
            const area = document.getElementById('checklist_render_area');
            const data = checklistData[turno];
            let html = `<h3>Checklist Corrente: ${turno}</h3>`;
            
            ['prima', 'inizio', 'durante', 'fine'].forEach(fase => {
                const tasks = data[fase] || [];
                const mancanti = tasks.length; // Per semplicit√† qui conto il totale, si pu√≤ affinare
                html += `
                    <div class="fase-header">
                        <strong>FASE: ${fase.toUpperCase()}</strong>
                        <span>Attivit√†: ${mancanti}</span>
                    </div>
                `;
                tasks.forEach(task => {
                    html += `
                        <div class="check-item">
                            <input type="checkbox" onchange="markTime(this)">
                            <div style="margin-left:10px;">
                                <strong>${task.t}</strong> <br>
                                <small>${task.n} - Codice: ${task.c}</small>
                            </div>
                            <span class="timestamp"></span>
                        </div>
                    `;
                });
            });
            area.innerHTML = html;
        }

        function markTime(cb) {
            const span = cb.parentElement.querySelector('.timestamp');
            span.innerText = cb.checked ? new Date().toLocaleTimeString() : '';
        }

        function saveChecklistTask() {
            const turno = document.getElementById('cfg_chk_turno').value;
            const fase = document.getElementById('cfg_chk_fase').value;
            const task = {
                t: document.getElementById('cfg_chk_titolo').value,
                n: document.getElementById('cfg_chk_note').value,
                c: document.getElementById('cfg_chk_codici').value
            };
            checklistData[turno][fase].push(task);
            saveAll();
            alert("Attivit√† salvata per " + turno);
        }

        function saveAll() {
            localStorage.setItem('nsif_accounts', JSON.stringify(accounts));
            localStorage.setItem('nsif_links', JSON.stringify(externalLinks));
            localStorage.setItem('nsif_checklists', JSON.stringify(checklistData));
        }
    </script>
</body>
</html>
