<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione - Gestione Accessi V10 Admin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; }

        /* HEADER ISTITUZIONALE */
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 1px solid #ddd; }
        .banner-top { width: 100%; max-width: 800px; height: auto; display: block; margin: 0 auto; }
        .header { width: 100%; background: white; padding: 15px 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom: 5px solid var(--securitas-red); }
        .logo-securitas { height: 35px; }
        
        .container { width: 95%; max-width: 600px; margin: 20px auto; padding-bottom: 50px; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: none; text-align: center; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--securitas-blue); font-size: 1.2rem; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; }
        
        /* BOTTONI */
        button { width: 100%; padding: 16px; margin: 8px 0; border: none; border-radius: 8px; background-color: var(--securitas-blue); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); }
        .btn-red { background: var(--securitas-red); }
        .btn-gray { background: #6c757d; font-size: 0.8rem; padding: 10px; }

        /* FORM */
        .form-group { text-align: left; margin-bottom: 15px; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: var(--securitas-blue); }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }

        /* ADMIN TABLE */
        .user-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        .user-table th, .user-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .user-table th { background: #f8f9fa; }
    </style>
</head>
<body>

    <div class="banner-container">
        <img src="logo_nsif.jpg" alt="Banner NSIF" class="banner-top" onerror="this.style.display='none'">
    </div>

    <div class="header">
        <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" alt="Securitas" class="logo-securitas">
        <div style="font-weight: bold; color: var(--securitas-blue); margin-top:5px;">SISTEMA GESTIONE UTENTI NSIF</div>
    </div>

    <div class="container">
        <div id="step_login" class="card active">
            <h2>Login Operatore</h2>
            <div class="form-group">
                <label>User (Email)</label>
                <input type="text" id="login_user" placeholder="marco.lamorgia@securitas.ch">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="login_pass" placeholder="••••••••">
            </div>
            <button onclick="handleLogin()">ACCEDI</button>
            <button class="btn-gray" onclick="alert('Contattare Marco La Morgia per il recupero password.')">Modifica / Recupera Password</button>
        </div>

        <div id="step_menu" class="card">
            <h2 id="welcome_text">Menu Principale</h2>
            <button onclick="showStep('step_oft')">Registrazione collaboratore OFT</button>
            <button class="btn-outline" id="admin_btn" onclick="showAdminPanel()" style="display:none;">⚙️ PANNELLO ADMIN (Gestione Utenti)</button>
            <button class="btn-red" onclick="location.reload()">LOGOUT</button>
        </div>

        <div id="step_admin" class="card">
            <h2>Gestione Utenti e Password</h2>
            <div class="form-group">
                <label>Nuovo Utente (Email)</label>
                <input type="text" id="new_user_email">
            </div>
            <div class="form-group">
                <label>Password Iniziale</label>
                <input type="text" id="new_user_pass">
            </div>
            <button class="btn-red" onclick="addUser()">CREA NUOVO ACCOUNT</button>
            
            <h3>Utenti Attivi</h3>
            <table class="user-table" id="users_list">
                <thead><tr><th>Email</th><th>Password</th><th>Azioni</th></tr></thead>
                <tbody></tbody>
            </table>
            <button class="btn-outline" onclick="showStep('step_menu')">TORNA AL MENU</button>
        </div>

        <div id="step_oft" class="card">
            <h2>Processo OFT</h2>
            <button onclick="alert('Funzione PDF integrata come versione precedente')">Esegui Lavorazione</button>
            <button class="btn-outline" onclick="showStep('step_menu')">INDIETRO</button>
        </div>
    </div>

    <script>
        // DATI AMMINISTRATORE FISSI
        const ADMIN_USER = "marco.lamorgia@securitas.ch";
        const ADMIN_PASS = "1234NSIF";

        function handleLogin() {
            const user = document.getElementById('login_user').value;
            const pass = document.getElementById('login_pass').value;

            // Controllo Admin
            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                sessionStorage.setItem('role', 'admin');
                document.getElementById('admin_btn').style.display = 'block';
                showStep('step_menu');
                return;
            }

            // Controllo Utenti salvati
            const users = JSON.parse(localStorage.getItem('nsif_users') || "[]");
            const found = users.find(u => u.email === user && u.pass === pass);

            if (found) {
                sessionStorage.setItem('role', 'user');
                document.getElementById('admin_btn').style.display = 'none';
                showStep('step_menu');
            } else {
                alert("Credenziali errate!");
            }
        }

        function showAdminPanel() {
            renderUsers();
            showStep('step_admin');
        }

        function addUser() {
            const email = document.getElementById('new_user_email').value;
            const pass = document.getElementById('new_user_pass').value;

            if(!email || !pass) return alert("Compila tutti i campi");

            const users = JSON.parse(localStorage.getItem('nsif_users') || "[]");
            users.push({email, pass});
            localStorage.setItem('nsif_users', JSON.stringify(users));
            
            document.getElementById('new_user_email').value = "";
            document.getElementById('new_user_pass').value = "";
            renderUsers();
        }

        function deleteUser(index) {
            const users = JSON.parse(localStorage.getItem('nsif_users') || "[]");
            users.splice(index, 1);
            localStorage.setItem('nsif_users', JSON.stringify(users));
            renderUsers();
        }

        function renderUsers() {
            const users = JSON.parse(localStorage.getItem('nsif_users') || "[]");
            const tbody = document.querySelector('#users_list tbody');
            tbody.innerHTML = "";
            
            users.forEach((u, index) => {
                tbody.innerHTML += `<tr>
                    <td>${u.email}</td>
                    <td>${u.pass}</td>
                    <td><button onclick="deleteUser(${index})" class="btn-red" style="padding:5px; margin:0; font-size:0.7rem;">Elimina</button></td>
                </tr>`;
            });
        }

        function showStep(id) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
