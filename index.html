<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione Hub - V5.0 MODULAR</title>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f4f7f9; --white: #ffffff; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        /* Layout */
        .header { background: var(--white); padding: 15px; text-align: center; border-bottom: 4px solid var(--securitas-red); }
        .logo { height: 35px; }
        .container { width: 95%; max-width: 900px; margin: 20px auto; padding-bottom: 50px; }
        
        /* Moduli Card */
        .module { background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: none; }
        .active { display: block; animation: fadeIn 0.3s; }
        
        /* UI Components */
        .btn { width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-blue { background: var(--securitas-blue); color: white; }
        .btn-red { background: var(--securitas-red); color: white; }
        .btn-gray { background: #6c757d; color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        
        .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; }
        .menu-item { background: white; padding: 25px; border-radius: 12px; border: 1px solid #eee; text-align: center; cursor: pointer; font-weight: bold; }
        .menu-item:hover { border-color: var(--securitas-red); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* Checklist & Flows */
        .flow-box { text-align: left; background: #f8f9fa; border-left: 5px solid var(--securitas-red); padding: 15px; margin: 15px 0; border-radius: 4px; }
        .check-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .timestamp { margin-left: auto; font-size: 0.75rem; color: #28a745; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.85rem; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body onload="Core.init()">

    <div class="header">
        <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" class="logo">
        <div style="font-size:0.7rem; font-weight:bold; color:var(--securitas-blue); margin-top:5px;">HUB OPERATIVO NSIF - V5.0 MODULAR</div>
    </div>

    <div class="container">

        <div id="mod-login" class="module active">
            <h2 style="text-align:center">LOGIN SISTEMA</h2>
            <input type="text" id="log-email" placeholder="Email Utente">
            <input type="password" id="log-pass" placeholder="Password">
            <button class="btn btn-blue" onclick="Auth.login()">ACCEDI</button>
        </div>

        <div id="mod-menu" class="module">
            <div id="display-date" style="text-align:center; font-size:1.4rem; font-weight:800; color:var(--securitas-blue); margin-bottom:20px;"></div>
            <div class="grid-menu">
                <div class="menu-item" onclick="Core.go('mod-accessi')">üõÇ CONTROLLO ACCESSI</div>
                <div class="menu-item btn-red" style="color:white" onclick="Core.go('mod-checklist-menu')">üìã CHECK-LIST TURNI</div>
                <div class="menu-item" onclick="window.open('https://app.bausicht.com/site/cmfciguey0me7vv19a6aj915n/dashboard', '_blank')">üåê BAUSICHT</div>
                <div id="adm-btn" class="menu-item btn-red" style="display:none; color:white" onclick="Admin.open()">‚öôÔ∏è ADMIN</div>
            </div>
            <button class="btn btn-gray" onclick="location.reload()" style="margin-top:30px">LOGOUT</button>
        </div>

        <div id="mod-accessi" class="module">
            <h2>GESTIONE ACCESSI & BADGE</h2>
            <button class="btn btn-red" onclick="Core.go('mod-flow-lost')">‚ö†Ô∏è BADGE SMARRITO / DIMENTICATO</button>
            <button class="btn btn-outline" onclick="Accessi.flow('oft')">üè¢ AZIENDA OFT (Nijaz)</button>
            <button class="btn btn-outline" onclick="Accessi.flow('ffs')">üè¢ AZIENDA FFS (La Morgia)</button>
            <button class="btn btn-blue" onclick="Core.go('mod-flow-visitor')">üÜï BADGE VISITATORE / CPC</button>
            <hr>
            <button class="btn btn-gray" onclick="Core.go('mod-menu')">INDIETRO</button>
        </div>

        <div id="mod-flow-lost" class="module">
            <h3>PROCEDURA BADGE SMARRITO / DIMENTICATO</h3>
            
            <div class="flow-box">
                <b>1. RICERCA:</b> Verificare il nominativo sul portale <b>Bausicht</b>.
            </div>
            <div class="flow-box">
                <b>2. AZIONE:</b> <br>
                - <b>Smarrito:</b> Bloccare il badge su Bausicht (Diventa Rosso).<br>
                - <b>Dimenticato:</b> Lasciare attivo, ma ritirare garanzia.
            </div>
            <div class="flow-box">
                <b>3. DEPOSITO GARANZIA:</b> Ritirare un documento (ID/Patente) o chiavi auto.
            </div>
            <div class="flow-box">
                <b>4. CONSEGNA:</b> Fornire badge provvisorio e registrare il numero.
            </div>
            <div class="flow-box">
                <b>5. RICONSEGNA:</b> Restituire il documento solo al ritorno del badge provvisorio.
            </div>
            <button class="btn btn-blue" onclick="Core.go('mod-accessi')">COMPLETATO</button>
        </div>

        <div id="mod-admin" class="module">
            <h2>GESTIONE UTENTI</h2>
            <div style="background:#eee; padding:15px; border-radius:8px; margin-bottom:15px;">
                <input type="text" id="adm-mail" placeholder="Email">
                <input type="text" id="adm-pass" placeholder="Password">
                <select id="adm-role">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <button class="btn btn-blue" onclick="Admin.save()">SALVA / MODIFICA</button>
            </div>
            <table id="user-table">
                <thead><tr><th>Email</th><th>Ruolo</th><th>Azioni</th></tr></thead>
                <tbody id="user-list"></tbody>
            </table>
            <button class="btn btn-gray" onclick="Core.go('mod-menu')">CHIUDI</button>
        </div>

        <div id="mod-checklist-menu" class="module">
            <h2>SCELTA TURNO</h2>
            <button class="btn btn-blue" onclick="Checklist.render('T1')">TURNO T1 (06:00 - 15:00)</button>
            <button class="btn btn-blue" onclick="Checklist.render('T2')">TURNO T2 (14:45 - 22:00)</button>
            <button class="btn btn-blue" onclick="Checklist.render('T3')">TURNO T3 (08:00 - 15:30)</button>
            <button class="btn btn-gray" onclick="Core.go('mod-menu')">INDIETRO</button>
        </div>

        <div id="mod-checklist-view" class="module">
            <h2 id="chk-title" style="text-align:center"></h2>
            <div id="chk-content"></div>
            <button class="btn btn-gray" onclick="Core.go('mod-checklist-menu')" style="margin-top:20px">INDIETRO</button>
        </div>

    </div>

    <script>
        // --- MODULO CORE: Navigazione e Inizializzazione ---
        const Core = {
            init: function() {
                if(!localStorage.getItem('nsif_users')) {
                    const master = [{email: "marco.lamorgia@securitas.ch", pass: "1234NSIF", role: "admin"}];
                    localStorage.setItem('nsif_users', JSON.stringify(master));
                }
                this.updateClock();
            },
            go: function(id) {
                document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                window.scrollTo(0,0);
            },
            updateClock: function() {
                const now = new Date();
                document.getElementById('display-date').innerText = now.toLocaleDateString('it-IT', {weekday:'long', day:'numeric', month:'long'}).toUpperCase();
                setTimeout(() => this.updateClock(), 1000);
            }
        };

        // --- MODULO AUTH: Gestione Accessi al Software ---
        const Auth = {
            login: function() {
                const u = document.getElementById('log-email').value;
                const p = document.getElementById('log-pass').value;
                const users = JSON.parse(localStorage.getItem('nsif_users'));
                const found = users.find(x => x.email === u && x.pass === p);
                
                if(found) {
                    if(found.role === 'admin') document.getElementById('adm-btn').style.display = 'block';
                    Core.go('mod-menu');
                } else { alert("Accesso negato."); }
            }
        };

        // --- MODULO ADMIN: Gestione Account ---
        const Admin = {
            open: function() { this.render(); Core.go('mod-admin'); },
            save: function() {
                const mail = document.getElementById('adm-mail').value;
                const pass = document.getElementById('adm-pass').value;
                const role = document.getElementById('adm-role').value;
                let users = JSON.parse(localStorage.getItem('nsif_users'));
                
                const idx = users.findIndex(x => x.email === mail);
                if(idx > -1) users[idx] = {email: mail, pass: pass, role: role};
                else users.push({email: mail, pass: pass, role: role});
                
                localStorage.setItem('nsif_users', JSON.stringify(users));
                this.render();
            },
            render: function() {
                const users = JSON.parse(localStorage.getItem('nsif_users'));
                document.getElementById('user-list').innerHTML = users.map((u, i) => `
                    <tr>
                        <td>${u.email}</td>
                        <td>${u.role}</td>
                        <td><button onclick="Admin.delete(${i})" class="btn-red" style="padding:5px">X</button></td>
                    </tr>
                `).join('');
            },
            delete: function(i) {
                let users = JSON.parse(localStorage.getItem('nsif_users'));
                users.splice(i, 1);
                localStorage.setItem('nsif_users', JSON.stringify(users));
                this.render();
            }
        };

        // --- MODULO ACCESSI: Flussi Operativi ---
        const Accessi = {
            flow: function(type) {
                if(type === 'oft') alert("FLUSSO OFT:\n- Riferimento: Nijaz\n- Verificare autorizzazione\n- Modulo accompagnamento obbligatorio");
                if(type === 'ffs') alert("FLUSSO FFS:\n- Riferimento: La Morgia\n- Controllo DPI\n- Verifica Bausicht");
            }
        };

        // --- MODULO CHECKLIST: Compiti Turni ---
        const Checklist = {
            data: {
                T1: { "Inizio": ["Apertura Campo Base (6988)", "Ufficio Coordinamento (1907)", "Accensione Telefono (6681)", "Radio Canale 15", "Apertura CAST07"], "Fine": ["Pulizia postazione", "Passaggio consegna CAST09"] },
                T2: { "Inizio": ["Apertura CAST09 (6988)", "Verifica barriere/luci", "Controllo monopattino"], "Fine": ["Straccio a terra", "Passaggio consegna"] },
                T3: { "Inizio": ["Ritiro telefono CAST07", "Giro cantiere", "Controllo CAST08"], "Fine": ["Riconsegna telefono"] }
            },
            render: function(turno) {
                const cont = document.getElementById('chk-content');
                document.getElementById('chk-title').innerText = "CHECKLIST INTEGRALE " + turno;
                cont.innerHTML = "";
                for(let sec in this.data[turno]) {
                    cont.innerHTML += `<div style="background:#eee; padding:10px; font-weight:bold; margin-top:15px">${sec}</div>`;
                    this.data[turno][sec].forEach(task => {
                        cont.innerHTML += `<div class="check-item"><input type="checkbox" onchange="this.nextElementSibling.nextElementSibling.innerText=this.checked?new Date().toLocaleTimeString():''"> <label>${task}</label> <span class="timestamp"></span></div>`;
                    });
                }
                Core.go('mod-checklist-view');
            }
        };
    </script>
</body>
</html>
