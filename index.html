<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V 1.8 BETA</title>
    <style>
        :root { --blue: #003366; --red: #e30613; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* LOGIN PAGE */
        #page_login { position: fixed; top:0; left:0; width: 100%; height: 100%; background: var(--blue); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .version-tag { color: #888; font-size: 0.8rem; margin-top: 20px; font-weight: bold; }

        /* HEADER - LOGO CENTRATO E GRANDE */
        .header { text-align: center; padding: 40px 20px; background: var(--white); border-bottom: 5px solid var(--red); }
        .logo-area { max-width: 600px; margin: 0 auto; }
        .logo-main { width: 100%; height: auto; max-height: 200px; object-fit: contain; }
        .version-label { color: var(--blue); font-weight: bold; margin-top: 20px; font-size: 1.4rem; }

        /* DASHBOARD */
        .dashboard-container { background: white; margin: 20px; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .clock-big { font-size: 3.5rem; font-weight: bold; color: var(--blue); margin: 10px 0; }

        /* NAV */
        .nav-bar { display: flex; justify-content: center; gap: 10px; padding: 15px; background: #ddd; }
        .nav-btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; background: var(--blue); color: white; font-weight: bold; }

        /* SECTIONS */
        .container { display: none; padding: 20px; max-width: 1100px; margin: auto; }
        .active-page { display: block; }
        
        /* CHECKLIST STYLE (RIPRISTINATO) */
        .fase-box { background: #fff; border-left: 8px solid var(--red); padding: 20px; margin-bottom: 25px; border-radius: 0 15px 15px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .fase-title { font-weight: bold; color: var(--blue); border-bottom: 2px solid #eee; margin-bottom: 15px; padding-bottom: 5px; font-size: 1.2rem; }
        .check-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #fafafa; }
        .ts-display { margin-left: auto; color: var(--red); font-weight: bold; font-family: monospace; }

        /* ADMIN TABLE */
        .admin-table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .admin-table input, .admin-table select { width: 90%; padding: 5px; }
    </style>
</head>
<body>

    <div id="page_login">
        <div class="login-card">
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" style="width:150px; margin-bottom:20px;">
            <input type="text" id="log_u" placeholder="E-mail">
            <input type="password" id="log_p" placeholder="Password">
            <button class="nav-btn" style="width: 100%; background: var(--red);" onclick="login()">ACCEDI</button>
            <div class="version-tag">SISTEMA GESTIONALE NSIF - VERSIONE 1.8 BETA</div>
        </div>
    </div>

    <div id="main_ui" style="display:none;">
        <div class="header">
            <div class="logo-area">
                <img src="logo_Consorzio.jpg" class="logo-main" alt="LOGO CONSORZIO NSIF" onerror="this.src='https://via.placeholder.com/600x200?text=LOGO+CONSORZIO+NSIF'">
            </div>
            <div class="version-label">NSFI CASTIONE â€“ GESTIONALE V 1.8 BETA</div>
        </div>

        <div class="nav-bar">
            <button class="nav-btn" onclick="showSection('section_home')">HOME</button>
            <button class="nav-btn" onclick="showSection('section_checklist')">CHECKLIST</button>
            <button id="nav_admin" class="nav-btn" style="background:#333; display:none;" onclick="showSection('section_admin')">AMMINISTRATORE</button>
            <button class="nav-btn" style="background:#666;" onclick="location.reload()">LOGOUT</button>
        </div>

        <div id="section_home" class="container active-page">
            <div class="dashboard-container">
                <div id="date_display" style="font-size: 1.4rem; color: #444;"></div>
                <div id="main_clock" class="clock-big">00:00:00</div>
            </div>
        </div>

        <div id="section_checklist" class="container">
            <div style="text-align:center; margin-bottom:20px;">
                <button class="nav-btn" onclick="loadChecklist('T1')">TURNO T1</button>
                <button class="nav-btn" onclick="loadChecklist('T2')">TURNO T2</button>
                <button class="nav-btn" onclick="loadChecklist('T3')">TURNO T3</button>
            </div>
            <div id="checklist_content"></div>
        </div>

        <div id="section_admin" class="container">
            <div style="background:white; padding:25px; border-radius:10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                <h3>Gestione Account e Permessi</h3>
                <div style="margin-bottom:20px; display:flex; gap:10px;">
                    <input type="text" id="new_e" placeholder="Email">
                    <input type="text" id="new_p" placeholder="Password">
                    <select id="new_l">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="superuser">Superuser</option>
                    </select>
                    <button class="nav-btn" style="background:green;" onclick="addAccount()">AGGIUNGI</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Password</th>
                            <th>Livello</th>
                            <th>Durata (GG)</th>
                            <th>Stato</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="user_tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const MASTER_ADMIN = "marco.lamorgia@securitas.ch";
        let accounts = JSON.parse(localStorage.getItem('nsif_db_v18')) || [
            {e: MASTER_ADMIN, p: "1234", l: "admin", s: "ATTIVO", d: 999}
        ];

        const checklistData = {
            T1: {
                "Inizio Turno": [
                    {i: "Aprire cancello Campo Base Nord", o: "Codice 6988"},
                    {i: "Aprire ufficio Campo Base Nord", o: "Codice 1907"},
                    {i: "Accendere telefono (Pin 6681)", o: "Sblocco 1907"},
                    {i: "Apertura CAST07", o: "Codice 1907"},
                    {i: "Verifica riscaldamento CAST07", o: "Pos. 2"}
                ],
                "Fine Turno": [
                    {i: "Pulizia ufficio e straccio terra", o: "CAST07"},
                    {i: "Passaggio consegna al CAST09", o: "Chiudere CAST07"}
                ]
            },
            T2: {
                "Inizio Turno": [
                    {i: "Aprire cancello CAST09", o: "Codice 6988"},
                    {i: "Aprire ufficio CAST09", o: "Codice 1907"},
                    {i: "Verifica riscaldamento CAST09", o: "Leva 3/4"}
                ],
                "Fine Turno": [
                    {i: "Pulizia postazione", o: "Superfici"},
                    {i: "Straccio a terra", o: "Entro ore 22:00"}
                ]
            },
            T3: {
                "Inizio Turno": [
                    {i: "Ritiro telefono al CAST07", o: ""},
                    {i: "Presa carico monopattino CAST09", o: ""}
                ],
                "Fine Turno": [
                    {i: "Chiusura rubinetti Campo Base Sud", o: "Verifica perdite"},
                    {i: "Rapporto anomalie", o: "Invia a La Morgia"}
                ]
            }
        };

        function login() {
            const u = document.getElementById('log_u').value;
            const p = document.getElementById('log_p').value;
            const user = accounts.find(a => a.e === u && a.p === p && a.s === "ATTIVO");
            if(user) {
                document.getElementById('page_login').style.display = 'none';
                document.getElementById('main_ui').style.display = 'block';
                if(user.l === 'admin') {
                    document.getElementById('nav_admin').style.display = 'block';
                    renderAdmin();
                }
                updateTime();
            } else { alert("Dati errati!"); }
        }

        function showSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
        }

        function loadChecklist(turno) {
            const data = checklistData[turno];
            let html = `<h2 style="color:var(--red); text-align:center;">MODULO ${turno}</h2>`;
            for(let fase in data) {
                html += `<div class="fase-box"><div class="fase-title">${fase.toUpperCase()}</div>`;
                data[fase].forEach(task => {
                    html += `<div class="check-item">
                        <input type="checkbox" style="transform:scale(1.4)" onchange="this.parentElement.querySelector('.ts-display').innerText = this.checked ? new Date().toLocaleTimeString() : ''">
                        <div style="margin-left:15px"><strong>${task.i}</strong><br><small>${task.o}</small></div>
                        <span class="ts-display"></span>
                    </div>`;
                });
                html += `</div>`;
            }
            document.getElementById('checklist_content').innerHTML = html;
        }

        function renderAdmin() {
            const tbody = document.getElementById('user_tbody');
            tbody.innerHTML = accounts.map((a, i) => `
                <tr>
                    <td>${a.e}</td>
                    <td><input type="text" value="${a.p}" onchange="updateAccount(${i}, 'p', this.value)"></td>
                    <td>
                        <select onchange="updateAccount(${i}, 'l', this.value)">
                            <option value="user" ${a.l=='user'?'selected':''}>User</option>
                            <option value="admin" ${a.l=='admin'?'selected':''}>Admin</option>
                        </select>
                    </td>
                    <td><input type="number" value="${a.d}" onchange="updateAccount(${i}, 'd', this.value)"></td>
                    <td style="color:${a.s==='ATTIVO'?'green':'red'}"><strong>${a.s}</strong></td>
                    <td>
                        <button onclick="toggleAcc(${i})">Stato</button>
                        ${a.e !== MASTER_ADMIN ? `<button onclick="delAcc(${i})">Elimina</button>` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function updateAccount(i, field, val) { accounts[i][field] = val; save(); }
        function toggleAcc(i) { accounts[i].s = accounts[i].s === "ATTIVO" ? "BLOCCATO" : "ATTIVO"; save(); }
        function delAcc(i) { if(confirm("Eliminare?")) { accounts.splice(i, 1); save(); } }
        function addAccount() {
            const e = document.getElementById('new_e').value;
            const p = document.getElementById('new_p').value;
            const l = document.getElementById('new_l').value;
            if(e && p) { accounts.push({e, p, l, s: "ATTIVO", d: 365}); save(); }
        }
        function save() { localStorage.setItem('nsif_db_v18', JSON.stringify(accounts)); renderAdmin(); }

        function updateTime() {
            const now = new Date();
            document.getElementById('main_clock').innerText = now.toLocaleTimeString('it-IT');
            document.getElementById('date_display').innerText = now.toLocaleDateString('it-IT', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
        }
        setInterval(updateTime, 1000);
    </script>
</body>
</html>

