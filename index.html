<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF CASTIONE - GESTIONALE V 1.5 BETA</title>
    <style>
        :root { --blue: #003366; --red: #e30613; --bg: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* LOGIN PAGE */
        #page_login { position: fixed; top:0; left:0; width: 100%; height: 100%; background: var(--blue); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 380px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* HEADER - LOGO CENTRATO */
        .header { text-align: center; padding: 30px; background: var(--white); border-bottom: 5px solid var(--red); }
        .logo-main { max-width: 300px; display: block; margin: 0 auto 10px auto; }
        .logo-sec { max-width: 150px; display: block; margin: 0 auto; }
        .version-label { color: var(--blue); font-weight: bold; margin-top: 15px; font-size: 1.2rem; }

        /* DASHBOARD */
        .dashboard-container { background: white; margin: 20px; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .clock-big { font-size: 3.5rem; font-weight: bold; color: var(--blue); margin: 10px 0; }
        .world-clocks { display: flex; justify-content: center; gap: 40px; color: #555; margin-top: 15px; }
        .world-clocks span { font-weight: bold; color: var(--red); }

        /* SEZIONE LINK ESTERNI */
        .links-area { background: #eee; margin: 20px; padding: 20px; border-radius: 15px; text-align: center; }
        .link-btn { padding: 15px 25px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; background: var(--blue); color: white; font-weight: bold; text-decoration: none; display: inline-block; }

        /* NAVIGATION */
        .nav-bar { display: flex; justify-content: center; gap: 10px; padding: 15px; background: #ddd; }
        .nav-btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; background: var(--blue); color: white; font-weight: bold; }

        /* SECTIONS */
        .container { display: none; padding: 20px; max-width: 1100px; margin: auto; }
        .active-page { display: block; }
        
        /* CHECKLIST STYLE */
        .fase-box { background: #fff; border-left: 5px solid var(--red); padding: 15px; margin-bottom: 20px; border-radius: 0 10px 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .fase-title { font-weight: bold; color: var(--blue); border-bottom: 1px solid #eee; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .check-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #fafafa; }
        .ts-display { margin-left: auto; color: var(--red); font-weight: bold; font-family: monospace; }

        /* ADMIN TABLE */
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f4f4f4; }
    </style>
</head>
<body>

    <div id="page_login">
        <div class="login-card">
            <img src="https://via.placeholder.com/200x80?text=CONSORZIO" style="margin-bottom:10px;">
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" style="width:120px; margin-bottom:20px;">
            <input type="text" id="log_u" placeholder="E-mail" onkeypress="handleEnter(event, 'log_p')">
            <input type="password" id="log_p" placeholder="Password" onkeypress="handleEnter(event, 'btn_l')">
            <button id="btn_l" class="nav-btn" style="width: 100%; background: var(--red);" onclick="login()">CONFERMA</button>
        </div>
    </div>

    <div id="main_ui" style="display:none;">
        <div class="header">
            <img src="https://via.placeholder.com/400x120?text=LOGO+CONSORZIO" class="logo-main" alt="Logo Consorzio">
            <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" class="logo-sec" alt="Securitas">
            <div class="version-label">NSFI CASTIONE – GESTIONALE V 1.5 BETA</div>
        </div>

        <div class="nav-bar">
            <button class="nav-btn" onclick="showSection('section_home')">HOME</button>
            <button class="nav-btn" onclick="showSection('section_checklist')">CHECKLIST TURNI</button>
            <button id="nav_admin" class="nav-btn" style="background:#333; display:none;" onclick="showSection('section_admin')">AMMINISTRATORE</button>
            <button class="nav-btn" style="background:#666;" onclick="location.reload()">LOGOUT</button>
        </div>

        <div id="section_home" class="container active-page">
            <div class="dashboard-container">
                <div id="date_display" style="font-size: 1.4rem; color: #444;"></div>
                <div id="main_clock" class="clock-big">00:00:00</div>
                <div class="world-clocks">
                    <div>Zurigo: <span id="tz_zur">00:00</span></div>
                    <div>Londra: <span id="tz_lon">00:00</span></div>
                    <div>N. York: <span id="tz_nyc">00:00</span></div>
                </div>
            </div>

            <div class="links-area">
                <h3 style="margin-top:0;">COLLEGAMENTI RAPIDI</h3>
                <a href="https://app.bausicht.com/site/cmfciguey0me7vv19a6aj915n/dashboard" target="_blank" class="link-btn">GESTIONE ACCESSI</a>
                <a href="https://ssgwp.sharepoint.com/teams/TONCH_Collab_2_16/Freigegebene%20Dokumente/Forms/AllItems.aspx?id=%2Fteams%2FTONCH%5FCollab%5F2%5F16%2FFreigegebene%20Dokumente%2FTON%20%26%20TAS%2FFFS%5FCantiere%20nuove%20officine%20Castione%2FNSIF%20Castione%20%2D%20Team&viewid=2f490dae%2Dafdc%2D4f24%2D837e%2D21504514e1e9" target="_blank" class="link-btn">VTI External</a>
            </div>
        </div>

        <div id="section_checklist" class="container">
            <div style="text-align:center; margin-bottom:20px;">
                <button class="nav-btn" onclick="loadChecklist('T1')">TURNO T1</button>
                <button class="nav-btn" onclick="loadChecklist('T2')">TURNO T2</button>
                <button class="nav-btn" onclick="loadChecklist('T3')">TURNO T3</button>
            </div>
            <div id="checklist_content"></div>
        </div>

        <div id="section_admin" class="container">
            <div style="background:white; padding:20px; border-radius:10px;">
                <h3>Gestione Account</h3>
                <div style="margin-bottom:20px; display:flex; gap:10px;">
                    <input type="text" id="new_e" placeholder="Email">
                    <input type="text" id="new_p" placeholder="Password">
                    <select id="new_l">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="superuser">Superuser</option>
                        <option value="gast">Gast</option>
                    </select>
                    <button class="nav-btn" style="background:green;" onclick="addAccount()">AGGIUNGI</button>
                </div>
                <table id="user_table">
                    <thead><tr><th>Email</th><th>Livello</th><th>Stato</th><th>Azioni</th></tr></thead>
                    <tbody id="user_tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_E = "marco.lamorgia@securitas.ch";
        let accounts = JSON.parse(localStorage.getItem('nsif_users')) || [
            {e: ADMIN_E, p: "1234", l: "admin", s: "ATTIVO", d: 365}
        ];

        const checklistData = {
            T1: {
                "Inizio Turno": [
                    {i: "Aprire cancello principale Campo Base Nord", o: "Codice 6988"},
                    {i: "Aprire ufficio Campo Base Nord", o: "Codice 1907"},
                    {i: "Accendere telefono di servizio (Pin 6681)", o: "Sblocco 1907 - Tenerlo fino arrivo T3"},
                    {i: "Recarsi al CAST07 ed effettuare apertura", o: "Codice 1907"},
                    {i: "Verifica riscaldamento CAST07", o: "Acceso temp. 2 in inverno"}
                ],
                "Durante il Turno": [
                    {i: "Verificare VTI External - Sharing documenti", o: "Controllo badge stampati"},
                    {i: "Prova collegamento Radio", o: "Canale 15"}
                ],
                "Fine Turno": [
                    {i: "Pulizia ufficio e straccio a terra", o: "CAST07"},
                    {i: "Passaggio consegna al CAST09", o: "Chiudere il CAST07"}
                ]
            },
            T2: {
                "Inizio Turno": [
                    {i: "Aprire cancello Entrata/Uscita CAST09", o: "Codice 6988"},
                    {i: "Aprire ufficio CAST09", o: "Codice 1907"},
                    {i: "Verificare riscaldamento CAST09", o: "Leva a 3/4 in inverno"}
                ],
                "Durante il Turno": [
                    {i: "Controllo fotocellule barriera", o: "Pulizia se ghiaccio/neve"},
                    {i: "Verifica carica monopattino", o: "Luce Verde = Carico"}
                ],
                "Fine Turno": [
                    {i: "Pulizia postazione (straccio superfici)", o: "CAST09"},
                    {i: "Passare lo straccio a terra", o: "Entro le ore 22:00"}
                ]
            },
            T3: {
                "Inizio Turno": [
                    {i: "Ritiro telefono di servizio al CAST07", o: ""},
                    {i: "Prendere monopattino dal CAST09", o: "Per spostamenti interni"}
                ],
                "Durante il Turno": [
                    {i: "Controlli generici cantiere interno/esterno", o: ""},
                    {i: "Verifica che il CAST08 sia presidiato", o: "Se aperto"}
                ],
                "Fine Turno": [
                    {i: "Chiusura rubinetti Campo Base Sud", o: "Verifica perdite"},
                    {i: "Redazione rapporto giornaliero", o: "Segnalazione anomalie a La Morgia"}
                ]
            }
        };

        function handleEnter(e, nextId) { if(e.key==='Enter') document.getElementById(nextId).focus(); }

        function login() {
            const u = document.getElementById('log_u').value;
            const p = document.getElementById('log_p').value;
            const user = accounts.find(a => a.e === u && a.p === p && a.s === "ATTIVO");
            
            if(user) {
                localStorage.setItem('last_user', u);
                document.getElementById('page_login').style.display = 'none';
                document.getElementById('main_ui').style.display = 'block';
                if(user.l === 'admin') {
                    document.getElementById('nav_admin').style.display = 'block';
                    renderAdmin();
                }
            } else { alert("Credenziali errate!"); }
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('main_clock').innerText = now.toLocaleTimeString('it-IT');
            document.getElementById('date_display').innerText = now.toLocaleDateString('it-IT', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
            document.getElementById('tz_zur').innerText = now.toLocaleTimeString('it-IT', {timeZone:'Europe/Zurich', hour:'2-digit', minute:'2-digit'});
            document.getElementById('tz_lon').innerText = now.toLocaleTimeString('it-IT', {timeZone:'Europe/London', hour:'2-digit', minute:'2-digit'});
            document.getElementById('tz_nyc').innerText = now.toLocaleTimeString('it-IT', {timeZone:'America/New_York', hour:'2-digit', minute:'2-digit'});
        }

        function showSection(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
        }

        function loadChecklist(turno) {
            const data = checklistData[turno];
            let html = `<h2>MODULO OPERATIVO ${turno}</h2>`;
            for(let fase in data) {
                html += `<div class="fase-box">
                    <div class="fase-title"><span>${fase.toUpperCase()}</span> <span>Attività: ${data[fase].length}</span></div>`;
                data[fase].forEach(task => {
                    html += `<div class="check-item">
                        <input type="checkbox" style="transform:scale(1.3)" onchange="this.parentElement.querySelector('.ts-display').innerText = this.checked ? new Date().toLocaleTimeString() : ''">
                        <div style="margin-left:15px"><strong>${task.i}</strong><br><small>${task.o}</small></div>
                        <span class="ts-display"></span>
                    </div>`;
                });
                html += `</div>`;
            }
            document.getElementById('checklist_content').innerHTML = html;
        }

        function renderAdmin() {
            const tbody = document.getElementById('user_tbody');
            tbody.innerHTML = accounts.map((a, i) => `
                <tr>
                    <td>${a.e}</td>
                    <td>${a.l}</td>
                    <td style="color:${a.s==='ATTIVO'?'green':'red'}"><strong>${a.s}</strong></td>
                    <td>
                        <button onclick="toggleAcc(${i})">Sblocca/Blocca</button>
                        ${a.e !== ADMIN_E ? `<button onclick="delAcc(${i})">Elimina</button>` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function addAccount() {
            const e = document.getElementById('new_e').value;
            const p = document.getElementById('new_p').value;
            const l = document.getElementById('new_l').value;
            if(e && p) {
                accounts.push({e, p, l, s: "ATTIVO", d: 365});
                save();
            }
        }

        function toggleAcc(i) { accounts[i].s = accounts[i].s === "ATTIVO" ? "DISATTIVATO" : "ATTIVO"; save(); }
        function delAcc(i) { if(confirm("Eliminare?")) { accounts.splice(i, 1); save(); } }
        function save() { localStorage.setItem('nsif_users', JSON.stringify(accounts)); renderAdmin(); }

        window.onload = () => {
            const last = localStorage.getItem('last_user');
            if(last) document.getElementById('log_u').value = last;
            updateTime();
            setInterval(updateTime, 1000);
        };
    </script>
</body>
</html>
