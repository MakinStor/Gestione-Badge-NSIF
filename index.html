<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSIF Castione - Gestione Accessi V2.5</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --securitas-blue: #003366; --securitas-red: #e30613; --bg: #f4f7f9; --success: #28a745; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; }
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 1px solid #ddd; }
        .banner-top { width: 100%; max-width: 800px; height: auto; display: block; margin: 0 auto; }
        .header { width: 100%; background: white; padding: 15px 0; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom: 5px solid var(--securitas-red); }
        .logo-securitas { height: 32px; }
        .container { width: 95%; max-width: 750px; margin: 20px auto; padding-bottom: 60px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); display: none; text-align: center; }
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        h2 { color: var(--securitas-blue); font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; text-transform: uppercase; }
        button { width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 8px; background-color: var(--securitas-blue); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-outline { background: transparent; border: 2px solid var(--securitas-blue); color: var(--securitas-blue); }
        .btn-red { background: var(--securitas-red); }
        .btn-gray { background: #6c757d; }
        .instruction-card { background: #e7f3ff; border-left: 5px solid var(--securitas-blue); padding: 15px; text-align: left; font-size: 0.95rem; line-height: 1.6; margin-bottom: 15px; border-radius: 4px; }
        .nota-box { background: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; margin: 10px 0; font-size: 0.85rem; text-align: left; color: #856404; }
        
        /* Checklist Styles */
        .checklist-item { text-align: left; padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: flex-start; gap: 15px; }
        .checklist-item input[type="checkbox"] { transform: scale(1.3); margin-top: 4px; }
        .checklist-item label { font-size: 0.95rem; color: #333; cursor: pointer; }
        .checklist-item small { display: block; color: var(--securitas-red); font-weight: bold; margin-top: 3px; }
        .timestamp { font-size: 0.75rem; color: var(--success); margin-left: auto; font-weight: bold; }

        .form-group { text-align: left; margin-bottom: 12px; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: var(--securitas-blue); }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.75rem; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    </style>
</head>
<body>

    <div class="banner-container"><img src="logo_nsif.jpg" alt="Banner NSIF" class="banner-top" onerror="this.style.display='none'"></div>
    <div class="header">
        <img src="https://www.securitas.ch/_assets/1f4f58cb8ec7ef7ef807190874a5a8cd/img/logos/securitas.svg" alt="Securitas" class="logo-securitas">
        <div style="font-weight: bold; color: var(--securitas-blue); font-size: 0.9rem; margin-top:5px;">NSIF CASTIONE - GESTIONE ACCESS V2.5</div>
    </div>

    <div class="container">
        <div id="step_login" class="card active">
            <h2>Accesso al Sistema</h2>
            <div class="form-group"><label>Email</label><input type="text" id="login_user"></div>
            <div class="form-group"><label>Password</label><input type="password" id="login_pass"></div>
            <button onclick="Auth.login()">ACCEDI</button>
            <p style="font-size: 0.8rem; color: var(--securitas-blue); cursor:pointer;" onclick="Auth.forgotPassword()">Password dimenticata?</p>
        </div>

        <div id="step_menu" class="card">
            <h2>Seleziona Attivit√†</h2>
            <button onclick="UI.showStep('step_azienda_tipo')">üõÇ GESTIONE ACCESSI (OFT/FFS)</button>
            <button class="btn-red" onclick="UI.showStep('step_checklist_menu')">üìã CHECKLIST TURNI</button>
            <button class="btn-outline" onclick="window.open('https://app.bausicht.com/', '_blank')">üåê APRI BAUSICHT</button>
            <div id="admin_area" style="display:none; margin-top: 20px; border-top: 2px dashed #ccc; padding-top: 10px;">
                <button class="btn-red" onclick="Admin.openPanel()">‚öôÔ∏è AMMINISTRATORE</button>
            </div>
            <button class="btn-gray" onclick="location.reload()" style="margin-top:20px;">LOGOUT</button>
        </div>

        <div id="step_azienda_tipo" class="card">
            <h2>Tipo Azienda</h2>
            <button onclick="Flows.selectAzienda('OFT')">Azienda gestita da OFT</button>
            <button onclick="Flows.selectAzienda('FFS')">Azienda gestita da FFS</button>
            <button class="btn-gray" onclick="UI.showStep('step_menu')">INDIETRO</button>
        </div>

        <div id="step_sistema" class="card">
            <h2 id="sys_title">Dipendente nel sistema?</h2>
            <button onclick="Flows.checkSistema(true)">S√å</button>
            <button class="btn-red" onclick="Flows.checkSistema(false)">NO</button>
        </div>

        <div id="step_formazione" class="card">
            <h2>Formazione "Induction" eseguita?</h2>
            <button onclick="Flows.checkFormazione(true)">S√å</button>
            <button class="btn-red" onclick="Flows.checkFormazione(false)">NO</button>
        </div>

        <div id="step_foto" class="card">
            <h2>Foto presente nel sistema?</h2>
            <button onclick="alert('Compito terminato.'); UI.showStep('step_menu');">S√å</button>
            <button class="btn-red" onclick="UI.showStep('step_situazione1')">NO</button>
        </div>

        <div id="step_situazione1" class="card">
            <h2>SITUAZIONE 1 - FOTO MANCANTE</h2>
            <div id="sit1_header" class="instruction-card"></div>
            <div class="instruction-card">
                ‚Ä¢ Effettuare la foto all'operaio.<br>
                ‚Ä¢ Ritirare Documento d'identit√† o chiavi auto.<br>
                ‚Ä¢ Rilasciare Badge Provvisorio.<br>
                ‚Ä¢ Nota nel sistema: Indicare motivo rilascio provvisorio.
            </div>
            <button class="btn-red" onclick="UI.showStep('step_backoffice')">VAI A STAMPA E LOGISTICA</button>
        </div>

        <div id="step_backoffice" class="card">
            <h2>Backoffice</h2>
            <div class="instruction-card">
                1. Stampa Badge Personale.<br>
                2. Compila modulo ritiro badge.<br>
                3. Consegna a <b>Loris Zatta</b>.<br>
                4. Lascia modulo firmato in cassetta <b>La Morgia</b>.
            </div>
            <button onclick="UI.showStep('step_menu')">OK</button>
        </div>

        <div id="step_checklist_menu" class="card">
            <h2>Turni Operativi</h2>
            <button onclick="Checklist.open('T1')">TURNO T1 (06:00 - 15:00)</button>
            <button onclick="Checklist.open('T2')">TURNO T2 (14:45 - 22:00)</button>
            <button onclick="Checklist.open('T3')">TURNO T3 (08:00 - 15:30)</button>
            <button class="btn-gray" onclick="UI.showStep('step_menu')">INDIETRO</button>
        </div>

        <div id="step_checklist_view" class="card">
            <h2 id="checklist_title"></h2>
            <div id="checklist_items_container"></div>
            <button class="btn-red" style="margin-top:20px;" onclick="Checklist.save()">CONCLUDI E TORNA AL MENU</button>
        </div>

        <div id="step_admin" class="card">
            <h2>Gestione Utenti</h2>
            <div id="admin_content">
                <input type="text" id="new_u" placeholder="Email">
                <input type="text" id="new_p" placeholder="Password">
                <button onclick="Admin.addUser()">AGGIUNGI</button>
                <div id="u_list_body"></div>
            </div>
            <button class="btn-gray" onclick="UI.showStep('step_menu')">ESCI</button>
        </div>
    </div>

    <script>
        // --- BLOCCO 1: LOGICA INTERFACCIA ---
        const UI = {
            showStep: (id) => {
                document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            }
        };

        // --- BLOCCO 2: AUTENTICAZIONE ---
        const Auth = {
            login: () => {
                const u = document.getElementById('login_user').value;
                const p = document.getElementById('login_pass').value;
                if (u === "marco.lamorgia@securitas.ch" && p === "1234NSIF") {
                    document.getElementById('admin_area').style.display = 'block';
                    UI.showStep('step_menu');
                } else { alert("Errore"); }
            },
            forgotPassword: () => {
                window.location.href = "mailto:marco.lamorgia@securitas.ch?subject=Reset Password NSIF";
            }
        };

        // --- BLOCCO 3: FLUSSI OPERATIVI ---
        const Flows = {
            selectAzienda: (az) => { aziendaSelezionata = az; UI.showStep('step_sistema'); },
            checkSistema: (p) => { 
                if(!p) alert("Chiama Pepeljak/La Morgia"); 
                else (aziendaSelezionata==='OFT' ? UI.showStep('step_formazione') : UI.showStep('step_foto'));
            },
            checkFormazione: (f) => {
                document.getElementById('sit1_header').innerText = f ? "Formazione OK - Foto NO" : "Formazione NON eseguita";
                UI.showStep(f ? 'step_foto' : 'step_situazione1');
            }
        };

        // --- BLOCCO 4: GESTIONE CHECKLIST ---
        const Checklist = {
            data: {
                T1: [
                    { t: "Apertura Cancello Campo Base Nord", n: "Codice 6988" },
                    { t: "Apertura Ufficio Campo Base Nord", n: "Codice 1907" },
                    { t: "Accensione Telefono Servizio", n: "Pin 6681 / Sblocco 1907" },
                    { t: "Apertura CAST07", n: "Codice 1907" },
                    { t: "Pulizia CAST07 (Straccio a terra)", n: "Disposizione fine turno" }
                ],
                T2: [
                    { t: "Apertura Cancelli CAST09", n: "Entrata e Uscita - Codice 6988" },
                    { t: "Apertura Ufficio CAST09", n: "Codice 1907" },
                    { t: "Verifica Barriera e Tornelli", n: "Segnalare anomalie" },
                    { t: "Pulizia Postazione CAST09", n: "Passare straccio terra prima delle 22:00" }
                ],
                T3: [
                    { t: "Verifica Parcheggio Coordinamento", n: "Posto centrale assegnato" },
                    { t: "Prova Radio", n: "Canale 15 - Collegamento OK" },
                    { t: "Ritiro Telefono CAST07", n: "Verifica chiamate perse" },
                    { t: "Giro Perlustrazione Cantiere", n: "Controllo recinzioni e accessi" }
                ]
            },
            open: function(turno) {
                document.getElementById('checklist_title').innerText = "CHECKLIST " + turno;
                const container = document.getElementById('checklist_items_container');
                container.innerHTML = this.data[turno].map((item, i) => `
                    <div class="checklist-item">
                        <input type="checkbox" id="check_${i}" onchange="Checklist.mark(${i})">
                        <label for="check_${i}">
                            <b>${item.t}</b>
                            <small>${item.n}</small>
                        </label>
                        <span id="time_${i}" class="timestamp"></span>
                    </div>
                `).join('');
                UI.showStep('step_checklist_view');
            },
            mark: function(i) {
                const cb = document.getElementById('check_'+i);
                const ts = document.getElementById('time_'+i);
                ts.innerText = cb.checked ? new Date().toLocaleTimeString('it-CH', {hour:'2-digit', minute:'2-digit'}) : "";
            },
            save: function() {
                alert("Checklist completata con successo.");
                UI.showStep('step_menu');
            }
        };

        // --- BLOCCO 5: ADMIN ---
        const Admin = {
            openPanel: () => { UI.showStep('step_admin'); }
        };

        // Key Listener
        document.getElementById('login_pass').addEventListener('keypress', (e) => { if(e.key==='Enter') Auth.login(); });
    </script>
</body>
</html>
